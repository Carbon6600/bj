<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blackjack AI Pro - Strategy Hunter</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, #0a1f2e 0%, #0b2b3b 100%);
            height: 100vh;
            height: 100dvh;
            color: #fff;
            overflow: hidden;
            position: fixed;
            width: 100%;
            font-size: 14px;
        }

        .game-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 4px;
            gap: 3px;
            max-width: 430px;
            margin: 0 auto;
            background: rgba(0,0,0,0.2);
            border-radius: 16px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a1f2e;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .loading-screen.hidden { display: none; }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(78,205,196,0.2);
            border-top-color: #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .header {
            background: rgba(10, 31, 46, 0.95);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid #4ecdc4;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .header-title { 
            font-size: 15px; 
            font-weight: 700; 
            background: linear-gradient(135deg, #4ecdc4, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: #ff6b6b;
        }

        .status-badge.ready { background: #4ecdc4; color: #000; }
        .status-badge.training { background: #ffd700; color: #000; animation: pulse 1s infinite; }
        .status-badge.selfplay { background: #00ff88; color: #000; animation: pulse 0.5s infinite; }
        .status-badge.autoplay { background: #ff6b6b; color: #fff; animation: pulse 0.3s infinite; }
        .status-badge.optimizing { background: #bc13fe; color: #fff; animation: pulse 0.8s infinite; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–ª–æ–¥–∏ */
        .deck-visualization {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(78,205,196,0.5);
            border-radius: 16px;
            padding: 8px 12px;
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .deck-title {
            font-size: 11px;
            color: #4ecdc4;
            text-transform: uppercase;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .deck-cards-left {
            background: rgba(78,205,196,0.15);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            color: #4ecdc4;
        }

        .deck-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            margin-left: 8px;
        }

        .temperature-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.15);
            border-radius: 3px;
            overflow: hidden;
        }

        .temperature-fill {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #00ff88, #ffd700, #ff6b6b);
            transition: width 0.3s;
        }

        .temperature-label {
            font-size: 10px;
            font-weight: 600;
            min-width: 55px;
            text-align: right;
            color: #ffd700;
        }

        .deck-cards-preview {
            display: flex;
            gap: 2px;
            margin-top: 6px;
            padding: 4px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .deck-cards-preview::-webkit-scrollbar {
            display: none;
        }

        .mini-card {
            width: 20px;
            height: 28px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            border-radius: 3px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            flex-shrink: 0;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .mini-card.red { color: #d32f2f; }
        .mini-card.back {
            background: linear-gradient(135deg, #b71c1c, #7f0000);
            border: 1px solid #ffd700;
        }

        .ai-viz-panel {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #00ff88;
            border-radius: 16px;
            padding: 10px;
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .ai-viz-title {
            font-size: 11px;
            color: #00ff88;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .decision-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }

        .decision-cell {
            padding: 8px 2px;
            border-radius: 12px;
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .decision-cell.hit { background: #2e7d32; color: #fff; }
        .decision-cell.stand { background: #c62828; color: #fff; }
        .decision-cell.double { background: #6a1b9a; color: #fff; }
        .decision-cell.split { background: #f9a825; color: #000; }
        .decision-cell.selected {
            box-shadow: 0 0 15px currentColor;
            transform: scale(1.05);
            border: 2px solid #fff;
        }
        .decision-cell.ai-thinking {
            animation: aiPulse 0.5s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { box-shadow: 0 0 5px #00ff88; }
            50% { box-shadow: 0 0 20px #00ff88; }
        }

        .decision-cell .prob {
            font-size: 8px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .reasoning-box {
            background: rgba(0,255,136,0.1);
            border-radius: 12px;
            padding: 8px;
            font-size: 10px;
            margin-top: 6px;
            border: 1px solid rgba(0,255,136,0.3);
        }

        .reasoning-title {
            color: #00ff88;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .factor-row {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .factor-row:last-child { border-bottom: none; }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 8px 6px;
            text-align: center;
            border: 1px solid rgba(255,215,0,0.3);
            position: relative;
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .stat-card.profit { border-color: #00ff88; }
        .stat-card.loss { border-color: #ff6b6b; }

        .stat-title { 
            font-size: 9px; 
            color: #888; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
        }
        
        .stat-value { 
            font-size: 16px; 
            font-weight: 700; 
            margin-top: 2px;
            line-height: 1.2;
        }
        
        .stat-value.positive { color: #00ff88; }
        .stat-value.negative { color: #ff6b6b; }
        .stat-value.neutral { color: #ffd700; }
        
        .stat-sub { 
            font-size: 9px; 
            color: #aaa; 
            margin-top: 2px;
        }

        .deposit-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 50%;
            color: #000;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .deposit-btn:active { transform: scale(0.9); }

        .auto-play-panel {
            background: rgba(255,107,107,0.15);
            border: 1px solid #ff6b6b;
            border-radius: 16px;
            padding: 10px;
            backdrop-filter: blur(4px);
        }

        .auto-play-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .auto-play-title {
            color: #ff6b6b;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .auto-play-status {
            font-size: 10px;
            color: #ff6b6b;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .auto-play-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            font-size: 10px;
        }

        .auto-stat {
            background: rgba(0,0,0,0.3);
            padding: 6px;
            border-radius: 10px;
            text-align: center;
        }

        .auto-stat-value {
            color: #ff6b6b;
            font-weight: 700;
            font-size: 12px;
        }

        .auto-controls {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .auto-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auto-btn-start {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: #fff;
        }

        .auto-btn-stop {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .auto-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
        }

        .speed-label {
            font-size: 9px;
            color: #aaa;
        }

        .speed-slider {
            flex: 1;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #ff6b6b;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .side-bets-panel {
            background: rgba(255,107,107,0.1);
            border: 1px solid #ff6b6b;
            border-radius: 16px;
            padding: 10px;
        }

        .side-bets-panel .panel-title { 
            color: #ff6b6b; 
            font-size: 11px; 
            font-weight: 600;
            text-transform: uppercase; 
            margin-bottom: 8px; 
            display: flex; 
            justify-content: space-between; 
        }

        .side-bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .side-bet-toggle {
            width: 40px;
            height: 22px;
            background: rgba(255,255,255,0.2);
            border-radius: 11px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .side-bet-toggle.active { background: #ff6b6b; }
        .side-bet-toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .side-bet-toggle.active::after { left: 20px; }

        .side-bet-amount {
            width: 50px;
            padding: 4px 6px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            color: #fff;
            font-size: 11px;
            text-align: center;
        }

        .betting-panel {
            background: rgba(255,215,0,0.1);
            border: 1px solid #ffd700;
            border-radius: 16px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .betting-panel .panel-title { 
            color: #ffd700; 
            font-size: 11px; 
            font-weight: 600;
            text-transform: uppercase; 
        }

        .bet-controls {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .bet-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 10px;
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bet-btn:active {
            background: rgba(255,215,0,0.4);
            transform: scale(0.95);
        }

        .bet-input {
            width: 70px;
            padding: 6px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #ffd700;
            border-radius: 8px;
            color: #fff;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-height: 0;
        }

        .game-box {
            background: rgba(0, 40, 20, 0.4);
            border-radius: 20px;
            padding: 10px;
            border: 1px solid rgba(255,215,0,0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(4px);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }

        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .box-title { 
            font-size: 12px; 
            color: #ffd700; 
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .score-pill {
            background: #ffd700;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .cards-area {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
            flex: 1;
            align-items: center;
            min-height: 70px;
        }

        .card {
            width: 48px;
            height: 68px;
            background: #fff;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            font-size: 12px;
            font-weight: 700;
            animation: dealCard 0.3s ease-out;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,215,0,0.3);
        }

        @media (min-width: 380px) {
            .card {
                width: 56px;
                height: 78px;
                font-size: 14px;
            }
        }

        @keyframes dealCard {
            from { transform: translateY(-30px) rotateY(90deg); opacity: 0; }
            to { transform: translateY(0) rotateY(0); opacity: 1; }
        }

        .card.red { color: #d32f2f; }
        .card.black { color: #212121; }
        .card-back {
            background: linear-gradient(135deg, #b71c1c, #7f0000);
            border: 2px solid #ffd700;
        }

        .card-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 22px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 12px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(78,205,196,0.3);
        }

        .mode-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            color: #aaa;
            backdrop-filter: blur(4px);
            transition: all 0.2s;
        }

        .tab-btn.active { 
            background: #4ecdc4; 
            color: #000;
            box-shadow: 0 4px 12px rgba(78,205,196,0.3);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .control-grid.four-cols {
            grid-template-columns: repeat(4, 1fr);
        }

        .big-btn {
            padding: 14px 8px;
            border: none;
            border-radius: 14px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        .big-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .big-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        .btn-train { background: linear-gradient(135deg, #bc13fe, #9c27b0); color: #fff; }
        .btn-selfplay { background: linear-gradient(135deg, #00ff88, #00cc6a); color: #000; }
        .btn-autoplay { background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; animation: glow 2s infinite; }
        .btn-stop { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; }
        .btn-deal { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: #000; }
        .btn-hit { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: #000; }
        .btn-stand { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; }
        .btn-double { background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: #fff; }
        .btn-split { background: linear-gradient(135deg, #ffeb3b, #fbc02d); color: #000; }
        .btn-optimize { background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255,107,107,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,107,107,0.8); }
        }

        .console-log {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 8px;
            font-size: 9px;
            max-height: 50px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            border: 1px solid rgba(78,205,196,0.3);
        }

        .log-line { 
            padding: 2px 0; 
            border-bottom: 1px solid rgba(255,255,255,0.05);
            white-space: nowrap;
        }
        
        .log-success { color: #00ff88; }
        .log-error { color: #ff6b6b; }
        .log-info { color: #4ecdc4; }
        .log-ai { color: #00ff88; }
        .log-autoplay { color: #ff6b6b; }
        .log-optimize { color: #bc13fe; }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: linear-gradient(135deg, #1a2f4b, #0d1f35);
            padding: 20px;
            border-radius: 24px;
            border: 2px solid #4ecdc4;
            max-width: 95vw;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .modal-title { 
            color: #4ecdc4; 
            font-size: 18px; 
            font-weight: 700;
            margin-bottom: 16px; 
        }
        
        .modal-btn { 
            padding: 14px; 
            background: #4ecdc4; 
            color: #000; 
            border: none; 
            border-radius: 14px; 
            font-weight: 700; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 12px;
            font-size: 15px;
        }
        
        .modal-btn.secondary { 
            background: rgba(255,255,255,0.1); 
            color: #fff; 
            border: 1px solid #4ecdc4; 
        }

        .deposit-input {
            width: 100%;
            padding: 14px;
            background: rgba(0,0,0,0.3);
            border: 1px solid #4ecdc4;
            border-radius: 14px;
            color: #fff;
            font-size: 15px;
            margin-bottom: 12px;
        }

        .full-strategy-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9px;
        }

        .full-strategy-table th, .full-strategy-table td {
            border: 1px solid rgba(255,255,255,0.3);
            padding: 6px 2px;
            text-align: center;
            min-width: 30px;
        }

        .full-strategy-table th {
            background: rgba(255,215,0,0.3);
            color: #ffd700;
            font-size: 9px;
        }

        .full-strategy-table .header-col {
            background: rgba(78,205,196,0.3);
            color: #4ecdc4;
            font-weight: bold;
        }

        .full-strategy-table .cell-h { background: #2e7d32; color: #fff; }
        .full-strategy-table .cell-s { background: #c62828; color: #fff; }
        .full-strategy-table .cell-d { background: #6a1b9a; color: #fff; }
        .full-strategy-table .cell-sp { background: #f9a825; color: #000; }
        .full-strategy-table .cell-optimized {
            border: 2px solid #00ff88 !important;
            box-shadow: 0 0 5px #00ff88;
        }

        .legend {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 12px 0;
            font-size: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .table-controls {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .table-control-btn {
            flex: 1;
            padding: 8px 4px;
            background: rgba(78,205,196,0.2);
            border: 1px solid #4ecdc4;
            border-radius: 10px;
            color: #4ecdc4;
            font-size: 10px;
            cursor: pointer;
            min-width: 60px;
            font-weight: 600;
        }

        .table-control-btn:active { background: #4ecdc4; color: #000; }

        .optimization-stats {
            background: rgba(188, 19, 254, 0.1);
            border: 1px solid #bc13fe;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            font-size: 11px;
        }

        .optimization-stats-title {
            color: #bc13fe;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #4ecdc4);
            transition: width 0.3s;
        }

        .ai-learning-status {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 12px;
            padding: 8px;
            margin-top: 8px;
            font-size: 10px;
        }

        .rule-change-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            margin-left: 4px;
            animation: blink 1s infinite;
        }

        .auto-action-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: #fff;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
            animation: pulse 0.5s infinite;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è iPhone 12 */
        @media (max-width: 390px) {
            .game-wrapper { padding: 3px; }
            .card { width: 42px; height: 62px; font-size: 11px; }
            .card-center { font-size: 18px; }
            .decision-cell { padding: 6px 2px; font-size: 9px; }
            .stat-value { font-size: 15px; }
            .big-btn { padding: 12px 6px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div style="color: #4ecdc4; font-size: 15px; font-weight: 600;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AI...</div>
    </div>

    <div class="game-wrapper">
        <div class="header">
            <div>
                <div class="header-title">‚ô†Ô∏è BLACKJACK PRO</div>
                <div style="font-size: 9px; color: #aaa;">AI Strategy Hunter</div>
            </div>
            <div class="status-badge" id="systemStatus">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
        </div>

        <!-- –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–ª–æ–¥–∏ -->
        <div class="deck-visualization" id="deckVisualization">
            <div class="deck-header">
                <div class="deck-title">
                    <span>üé¥ –ö–û–õ–û–î–ê</span>
                    <span class="deck-cards-left" id="deckCardsCount">312</span>
                </div>
                <div class="deck-indicator">
                    <div class="temperature-bar">
                        <div class="temperature-fill" id="deckTemperatureFill" style="width: 50%;"></div>
                    </div>
                    <span class="temperature-label" id="deckTemperatureLabel">üî• –ì–∞—Ä—è—á–∞</span>
                </div>
            </div>
            <div class="deck-cards-preview" id="deckPreview">
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
            </div>
        </div>

        <div class="stats-dashboard">
            <div class="stat-card" id="statBalance">
                <button class="deposit-btn" onclick="showDepositModal()">+</button>
                <div class="stat-title">–ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value neutral" id="balanceValue">‚Ç¥1000</div>
                <div class="stat-sub" id="balanceSub">TC: 0.0</div>
            </div>
            <div class="stat-card" id="statProfit">
                <div class="stat-title">–ü—Ä–∏–±—É—Ç–æ–∫</div>
                <div class="stat-value neutral" id="profitValue">‚Ç¥0</div>
                <div class="stat-sub" id="profitPercent">0%</div>
            </div>
            <div class="stat-card" id="statWinRate">
                <div class="stat-title">–¢–æ—á–Ω—ñ—Å—Ç—å AI</div>
                <div class="stat-value neutral" id="accuracyValue">0%</div>
                <div class="stat-sub" id="gamesCount">0 —ñ–≥–æ—Ä</div>
            </div>
        </div>

        <div class="auto-play-panel" id="autoPlayPanel" style="display: none;">
            <div class="auto-play-header">
                <span class="auto-play-title">ü§ñ –ê–í–¢–û–ì–†–ê AI</span>
                <span class="auto-play-status" id="autoPlayStatus">–ì—Ä–∞—î...</span>
            </div>
            <div class="auto-play-stats">
                <div class="auto-stat">
                    <div>–Ü–≥–æ—Ä</div>
                    <div class="auto-stat-value" id="autoGames">0</div>
                </div>
                <div class="auto-stat">
                    <div>–í–∏–≥—Ä–∞—à</div>
                    <div class="auto-stat-value" id="autoWinAmount">‚Ç¥0</div>
                </div>
                <div class="auto-stat">
                    <div>–°–µ—Ä—ñ—è</div>
                    <div class="auto-stat-value" id="autoStreak">0</div>
                </div>
            </div>
            <div class="speed-control">
                <span class="speed-label">–®–≤–∏–¥–∫—ñ—Å—Ç—å:</span>
                <input type="range" class="speed-slider" id="autoSpeed" min="1" max="5" value="3">
                <span class="speed-label" id="speedValue">3x</span>
            </div>
            <div class="auto-controls">
                <button class="auto-btn auto-btn-stop" onclick="stopAutoPlay()">‚èπ –ó–£–ü–ò–ù–ò–¢–ò</button>
                <button class="auto-btn" onclick="toggleAutoPause()" id="pauseBtn" style="background: #4ecdc4; color: #000;">‚è∏ –ü–ê–£–ó–ê</button>
            </div>
        </div>

        <div class="ai-viz-panel" id="aiVizPanel">
            <div class="ai-viz-title">
                <span>üß† AI –ê–Ω–∞–ª—ñ–∑ <span id="learningIndicator" class="rule-change-indicator" style="display: none;"></span></span>
                <span style="font-size: 10px; color: #aaa;" id="vizStatus">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è...</span>
            </div>
            
            <div class="decision-grid" id="decisionGrid">
                <div class="decision-cell hit" id="cell-hit" onclick="playerAction('hit')">
                    HIT<br>–í–ó–Ø–¢–ò
                    <div class="prob" id="prob-hit">0%</div>
                </div>
                <div class="decision-cell stand" id="cell-stand" onclick="playerAction('stand')">
                    STAND<br>–°–¢–û–ü
                    <div class="prob" id="prob-stand">0%</div>
                </div>
                <div class="decision-cell double" id="cell-double" onclick="playerAction('double')">
                    DOUBLE<br>–ü–û–î–í–Ü–ô–ù–ê
                    <div class="prob" id="prob-double">0%</div>
                </div>
                <div class="decision-cell split" id="cell-split" onclick="playerAction('split')">
                    SPLIT<br>–†–û–ó–î–Ü–õ–ò–¢–ò
                    <div class="prob" id="prob-split">0%</div>
                </div>
            </div>

            <div class="ai-learning-status" id="learningStatus" style="display: none;">
                <div style="color: #00ff88; font-weight: bold; margin-bottom: 4px;">üìö –°–∞–º–æ–Ω–∞–≤—á–∞–Ω–Ω—è –≤ –ø—Ä–æ—Ü–µ—Å—ñ...</div>
                <div style="display: flex; justify-content: space-between; font-size: 9px;">
                    <span>–°–∏–º—É–ª—è—Ü—ñ–π: <span id="simCount">0</span></span>
                    <span>–ó–º—ñ–Ω –ø—Ä–∞–≤–∏–ª: <span id="ruleChanges">0</span></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="learningProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="reasoning-box" id="reasoningBox" style="display: none;">
                <div class="reasoning-title">üìä –§–∞–∫—Ç–æ—Ä–∏ —Ä—ñ—à–µ–Ω–Ω—è:</div>
                <div id="factorsList"></div>
            </div>
        </div>

        <div class="side-bets-panel">
            <div class="panel-title">
                <span>üé≤ –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏</span>
                <span style="font-size: 10px; color: #aaa;" id="totalSideBets">‚Ç¥0</span>
            </div>
            <div class="side-bet-item">
                <span>Perfect Pairs</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" class="side-bet-amount" id="perfectPairsBet" value="0" min="0" step="50" onchange="updateSideBet('perfectPairs')">
                    <div class="side-bet-toggle" id="perfectPairsToggle" onclick="toggleSideBet('perfectPairs')"></div>
                </div>
            </div>
            <div class="side-bet-item">
                <span>21+3</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" class="side-bet-amount" id="twentyOnePlusThreeBet" value="0" min="0" step="50" onchange="updateSideBet('twentyOnePlusThree')">
                    <div class="side-bet-toggle" id="twentyOnePlusThreeToggle" onclick="toggleSideBet('twentyOnePlusThree')"></div>
                </div>
            </div>
        </div>

        <div class="betting-panel">
            <div class="panel-title">üí∞ –°—Ç–∞–≤–∫–∞</div>
            <div class="bet-controls">
                <button class="bet-btn" onclick="changeBet(-50)">‚àí</button>
                <input type="number" class="bet-input" id="currentBetInput" value="250" min="50" step="50" onchange="updateBetFromInput()">
                <button class="bet-btn" onclick="changeBet(50)">+</button>
            </div>
        </div>

        <div class="game-area">
            <div class="game-box">
                <div class="box-header">
                    <span class="box-title">üé∞ –î–ò–õ–ï–†</span>
                    <span class="score-pill" id="dealerScore">--</span>
                </div>
                <div class="cards-area" id="dealerCards"></div>
            </div>

            <div class="game-box">
                <div class="box-header">
                    <span class="box-title">ü§ñ –í–ò</span>
                    <span class="score-pill" id="playerScore">--</span>
                </div>
                <div class="cards-area" id="playerCards"></div>
            </div>
        </div>

        <div class="controls">
            <div class="mode-tabs">
                <button class="tab-btn active" onclick="setMode('manual')" id="tabManual">üéÆ –ì—Ä–∞</button>
                <button class="tab-btn" onclick="setMode('train')" id="tabTrain">üéì –ù–∞–≤—á–∞–Ω–Ω—è</button>
                <button class="tab-btn" onclick="showFullTable()" id="tabTable">üìã –¢–∞–±–ª–∏—Ü—è</button>
            </div>

            <div class="control-grid" id="controlArea">
                <button class="big-btn btn-deal" onclick="newRound()" id="mainBtn">üé≤ –ù–û–í–ê –ì–†–ê</button>
                <button class="big-btn btn-autoplay" onclick="startAutoPlay()" id="secondBtn">ü§ñ –ê–í–¢–û–ì–†–ê</button>
            </div>
        </div>

        <div class="console-log" id="consoleLog">
            <div class="log-line log-info">–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è...</div>
        </div>
    </div>

    <div class="modal" id="tableModal">
        <div class="modal-content">
            <div class="modal-title">üìã –¢–∞–±–ª–∏—Ü—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó <span id="tableOptimizedBadge" style="display: none; background: #00ff88; color: #000; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 8px;">–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û</span></div>
            
            <div class="optimization-stats" id="optimizationStats" style="display: none;">
                <div class="optimization-stats-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <div>–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤: <span id="scenariosTested" style="color: #00ff88; font-weight: bold;">0</span></div>
                    <div>–ü–æ–∫—Ä–∞—â–µ–Ω—å –∑–Ω–∞–π–¥–µ–Ω–æ: <span id="improvementsFound" style="color: #00ff88; font-weight: bold;">0</span></div>
                    <div>ROI –±–∞–∑–æ–≤–æ—ó: <span id="baseROI" style="color: #ffd700;">0%</span></div>
                    <div>ROI –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ—ó: <span id="optimizedROI" style="color: #00ff88; font-weight: bold;">0%</span></div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-box" style="background: #2e7d32;"></div> H=Hit</div>
                <div class="legend-item"><div class="legend-box" style="background: #c62828;"></div> S=Stand</div>
                <div class="legend-item"><div class="legend-box" style="background: #6a1b9a;"></div> D=Double</div>
                <div class="legend-item"><div class="legend-box" style="background: #f9a825;"></div> SP=Split</div>
                <div class="legend-item"><div class="legend-box" style="border: 2px solid #00ff88; background: transparent;"></div> –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ</div>
            </div>

            <div class="table-controls">
                <button class="table-control-btn" onclick="switchTableView('hard')">Hard</button>
                <button class="table-control-btn" onclick="switchTableView('soft')">Soft</button>
                <button class="table-control-btn" onclick="switchTableView('pairs')">Pairs</button>
                <button class="table-control-btn" onclick="resetToBasicStrategy()">üîÑ –°–∫–∏–Ω—É—Ç–∏</button>
                <button class="table-control-btn" onclick="exportStrategy()">üíæ –ï–∫—Å–ø–æ—Ä—Ç</button>
            </div>

            <div id="tableContainer"></div>
            
            <button class="modal-btn" onclick="hideTableModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-title">üí∞ –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É</div>
            <input type="number" class="deposit-input" id="depositAmount" placeholder="–°—É–º–∞ (‚Ç¥)" min="100" step="100">
            <button class="modal-btn" onclick="confirmDeposit()">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</button>
            <button class="modal-btn secondary" onclick="hideDepositModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let tfModel = null;
        let isModelReady = false;
        let balance = 1000;
        let startingBalance = 1000; // –§—ñ–∫—Å—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ø—Ä–∏–±—É—Ç–∫—É
        let currentBet = 250;
        let deck = [];
        let dealerHand = [];
        let playerHand = [];
        let playerHands = [];
        let currentHandIndex = 0;
        let runningCount = 0;
        let trueCount = 0;
        let gameState = 'idle'; // 'idle', 'playing', 'dealer', 'finished'
        let isAutoPlaying = false;
        let autoPlayPaused = false;
        let autoPlaySpeed = 3;
        let isSelfPlaying = false;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let stats = { 
            totalGames: 0, 
            wins: 0, 
            losses: 0, 
            pushes: 0, 
            correctDecisions: 0, 
            totalDecisions: 0 
        };
        
        // –ê–≤—Ç–æ–≥—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let autoPlayStats = {
            gamesPlayed: 0,
            totalWon: 0,
            totalLost: 0,
            currentStreak: 0,
            startBalance: 1000
        };
        
        // –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏
        let sideBets = {
            perfectPairs: { active: false, amount: 0 },
            twentyOnePlusThree: { active: false, amount: 0 }
        };

        // –î–∞–Ω—ñ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
        let optimizationData = {
            simulationsRun: 0,
            rulesChanged: 0,
            baseStrategyROI: 0,
            optimizedROI: 0,
            improvedCells: new Set(),
            scenariosRun: 0
        };

        // –ë–∞–∑–æ–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è
        const baseStrategy = {
            hard: {
                8:  {2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H',A:'H'},
                9:  {2:'H',3:'D',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                10: {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'H',A:'H'},
                11: {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'D',A:'D'},
                12: {2:'H',3:'H',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                13: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                14: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                15: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                16: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                17: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                18: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                19: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                20: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'}
            },
            soft: {
                'A2': {2:'H',3:'H',4:'H',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A3': {2:'H',3:'H',4:'H',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A4': {2:'H',3:'H',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A5': {2:'H',3:'H',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A6': {2:'H',3:'D',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A7': {2:'S',3:'D',4:'D',5:'D',6:'D',7:'S',8:'S',9:'H',10:'H',A:'H'},
                'A8': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                'A9': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'}
            },
            pairs: {
                '2,2': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '3,3': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '4,4': {2:'H',3:'H',4:'H',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '5,5': {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'H',A:'H'},
                '6,6': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '7,7': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'H',9:'H',10:'H',A:'H'},
                '8,8': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'SP',9:'SP',10:'SP',A:'SP'},
                '9,9': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'S',8:'SP',9:'SP',10:'S',A:'S'},
                '10,10': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                'A,A': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'SP',9:'SP',10:'SP',A:'SP'}
            }
        };

        let optimizedStrategy = JSON.parse(JSON.stringify(baseStrategy));

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await tf.ready();
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Å—Ç—É –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—É
                tfModel = tf.sequential({
                    layers: [
                        tf.layers.dense({inputShape: [15], units: 64, activation: 'relu'}),
                        tf.layers.dense({units: 32, activation: 'relu'}),
                        tf.layers.dense({units: 4, activation: 'softmax'})
                    ]
                });
                
                tfModel.compile({
                    optimizer: tf.train.adam(0.001), 
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });
                
                isModelReady = true;
                createDeck();
                updateDisplay();
                
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
                document.getElementById('systemStatus').classList.add('ready');
                
                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                document.getElementById('autoSpeed').addEventListener('input', (e) => {
                    autoPlaySpeed = parseInt(e.target.value);
                    document.getElementById('speedValue').textContent = autoPlaySpeed + 'x';
                });
                
                addLog('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!', 'success');
            } catch (err) {
                console.error(err);
                addLog('–ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
            }
        });

        // === –§–£–ù–ö–¶–Ü–á –î–õ–Ø –ö–û–õ–û–î–ò ===
        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = [
                {n:'2',v:2,c:1}, {n:'3',v:3,c:1}, {n:'4',v:4,c:1}, {n:'5',v:5,c:1},
                {n:'6',v:6,c:1}, {n:'7',v:7,c:0}, {n:'8',v:8,c:0}, {n:'9',v:9,c:0},
                {n:'10',v:10,c:-1}, {n:'J',v:10,c:-1}, {n:'Q',v:10,c:-1}, {n:'K',v:10,c:-1}, {n:'A',v:11,c:-1}
            ];
            
            deck = [];
            for (let d = 0; d < 6; d++) {
                for (let s of suits) {
                    for (let v of values) {
                        deck.push({
                            name: v.n, 
                            value: v.v, 
                            count: v.c, 
                            suit: s, 
                            isRed: s === '‚ô•' || s === '‚ô¶'
                        });
                    }
                }
            }
            
            // –ü–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            runningCount = 0;
            trueCount = 0;
            updateDeckVisualization();
        }

        function draw() {
            if (deck.length < 20) {
                addLog('–ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞ –∫–æ–ª–æ–¥–∏...', 'info');
                createDeck();
            }
            const card = deck.pop();
            runningCount += card.count;
            const decksRemaining = deck.length / 52;
            trueCount = decksRemaining > 0 ? runningCount / decksRemaining : 0;
            updateDeckVisualization();
            return card;
        }

        function updateDeckVisualization() {
            const cardsLeft = deck.length;
            document.getElementById('deckCardsCount').textContent = cardsLeft;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É" –∫–æ–ª–æ–¥–∏
            let tempLabel = '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–∞';
            let tempColor = '#00ff88';
            let fillPercent = 30;
            
            if (trueCount > 2) {
                tempLabel = 'üî• –ì–∞—Ä—è—á–∞';
                tempColor = '#ff6b6b';
                fillPercent = 90;
            } else if (trueCount > 1) {
                tempLabel = '‚ö´ –¢–µ–ø–ª–∞';
                tempColor = '#ffd700';
                fillPercent = 70;
            } else if (trueCount > 0.5) {
                tempLabel = '‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞';
                tempColor = '#4ecdc4';
                fillPercent = 50;
            } else if (trueCount < -1) {
                tempLabel = '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–∞';
                tempColor = '#4ecdc4';
                fillPercent = 30;
            } else if (trueCount < -2) {
                tempLabel = 'üßä –î—É–∂–µ —Ö–æ–ª–æ–¥–Ω–∞';
                tempColor = '#00ff88';
                fillPercent = 20;
            }
            
            document.getElementById('deckTemperatureFill').style.width = fillPercent + '%';
            document.getElementById('deckTemperatureLabel').textContent = tempLabel;
            document.getElementById('deckTemperatureLabel').style.color = tempColor;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –≤–µ—Ä—Ö–Ω—ñ –∫–∞—Ä—Ç–∏
            const preview = document.getElementById('deckPreview');
            preview.innerHTML = '';
            
            const previewCards = deck.slice(-8).reverse();
            for (let card of previewCards) {
                const miniCard = document.createElement('div');
                miniCard.className = `mini-card ${card.isRed ? 'red' : 'black'}`;
                if (card.name === 'A') miniCard.textContent = 'A';
                else if (card.value === 10 && card.name !== '10') miniCard.textContent = card.name;
                else miniCard.textContent = card.value;
                preview.appendChild(miniCard);
            }
            
            while (preview.children.length < 8) {
                const emptyCard = document.createElement('div');
                emptyCard.className = 'mini-card back';
                preview.appendChild(emptyCard);
            }
        }

        // === –§–£–ù–ö–¶–Ü–á –ì–†–ò ===
        function calcScore(hand) {
            let score = 0;
            let aces = 0;
            for (let card of hand) {
                score += card.value;
                if (card.name === 'A') aces++;
            }
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            return score;
        }

        function isSoftHand(hand) {
            let hasAce = false;
            let score = 0;
            for (let card of hand) {
                if (card.name === 'A' && !hasAce) {
                    score += 11;
                    hasAce = true;
                } else {
                    score += card.value;
                }
            }
            return hasAce && score <= 21;
        }

        function canSplitHand(hand) {
            return hand.length === 2 && hand[0].value === hand[1].value;
        }

        function getCurrentState() {
            const currentHand = playerHands[currentHandIndex] || playerHand;
            return {
                playerScore: calcScore(currentHand),
                dealerCard: dealerHand[0]?.value || 0,
                canSplit: canSplitHand(currentHand),
                canDouble: currentHand.length === 2,
                isSoft: isSoftHand(currentHand),
                numCards: currentHand.length
            };
        }

        // === –ù–û–í–ê –ì–†–ê ===
        function newRound() {
            if (isAutoPlaying) return;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≥—Ä–∞ –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—ñ
            if (gameState === 'playing') {
                if (!confirm('–ì—Ä–∞ –≤ –ø—Ä–æ—Ü–µ—Å—ñ. –ü–æ—á–∞—Ç–∏ –Ω–æ–≤—É?')) return;
            }
            
            if (balance < currentBet) {
                addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!', 'error');
                showDepositModal();
                return;
            }

            // –°–∫–∏–¥–∞—î–º–æ —Ä—É–∫–∏
            playerHands = [];
            currentHandIndex = 0;
            
            // –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏
            let sideBetTotal = 0;
            if (sideBets.perfectPairs.active) sideBetTotal += sideBets.perfectPairs.amount;
            if (sideBets.twentyOnePlusThree.active) sideBetTotal += sideBets.twentyOnePlusThree.amount;
            
            if (sideBetTotal > 0 && balance >= currentBet + sideBetTotal) {
                balance -= sideBetTotal;
                addLog(`–ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏: -‚Ç¥${sideBetTotal}`, 'info');
            }

            // –û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–∞–≤–∫–∞
            balance -= currentBet;
            
            // –†–æ–∑–¥–∞—î–º–æ –∫–∞—Ä—Ç–∏
            dealerHand = [draw(), draw()];
            playerHand = [draw(), draw()];
            playerHands.push([...playerHand]);
            
            gameState = 'playing';
            
            updateDisplay();
            updateStats();
            updateControls();
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –±–ª–µ–∫–¥–∂–µ–∫
            setTimeout(() => {
                if (gameState === 'playing') checkBlackjack();
                visualizeAIDecision();
            }, 300);
            
            addLog(`–ù–æ–≤–∞ –≥—Ä–∞. –°—Ç–∞–≤–∫–∞: ‚Ç¥${currentBet}`, 'info');
        }

        function checkBlackjack() {
            const pScore = calcScore(playerHand);
            const dScore = calcScore(dealerHand);
            const dUpCard = dealerHand[0].value;
            
            // –ë–ª–µ–∫–¥–∂–µ–∫ –≥—Ä–∞–≤—Ü—è
            if (pScore === 21 && playerHand.length === 2) {
                if (dScore === 21 && dealerHand.length === 2) {
                    // –ù—ñ—á–∏—è - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∞–≤–∫—É
                    balance += currentBet;
                    addLog('–ü–æ–¥–≤—ñ–π–Ω–∏–π –ë–ª–µ–∫–¥–∂–µ–∫! –ù—ñ—á–∏—è', 'info');
                    endRound('push');
                } else {
                    // –í–∏–≥—Ä–∞—à 3:2
                    const winAmount = currentBet * 2.5;
                    balance += winAmount;
                    addLog(`üéâ –ë–ª–µ–∫–¥–∂–µ–∫! +‚Ç¥${Math.floor(winAmount - currentBet)}`, 'success');
                    stats.wins++;
                    stats.totalGames++;
                    endRound('win');
                }
                return true;
            }
            
            // –ë–ª–µ–∫–¥–∂–µ–∫ –¥–∏–ª–µ—Ä–∞
            if (dScore === 21 && dealerHand.length === 2) {
                addLog('–î–∏–ª–µ—Ä –º–∞—î –±–ª–µ–∫–¥–∂–µ–∫!', 'error');
                stats.losses++;
                stats.totalGames++;
                endRound('lose');
                return true;
            }
            
            return false;
        }

        // === –î–Ü–á –ì–†–ê–í–¶–Ø ===
        async function playerAction(action) {
            if (gameState !== 'playing' || isAutoPlaying) return;
            
            const currentHand = playerHands[currentHandIndex];
            const state = getCurrentState();
            
            if (action === 'double' && !state.canDouble) {
                addLog('–ü–æ–¥–≤—ñ–π–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                return;
            }
            if (action === 'split' && !state.canSplit) {
                addLog('–°–ø–ª—ñ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
                return;
            }

            // –í—ñ–¥—Å—Ç–µ–∂—É—î–º–æ —Ä—ñ—à–µ–Ω–Ω—è AI
            const aiDecision = await visualizeAIDecision();
            if (aiDecision) {
                stats.totalDecisions++;
                if (aiDecision.bestAction === action) stats.correctDecisions++;
            }

            switch(action) {
                case 'hit':
                    currentHand.push(draw());
                    addLog('–ì—Ä–∞–≤–µ—Ü—å –±–µ—Ä–µ –∫–∞—Ä—Ç—É', 'info');
                    
                    if (calcScore(currentHand) > 21) {
                        if (currentHandIndex < playerHands.length - 1) {
                            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó —Ä—É–∫–∏
                            currentHandIndex++;
                            updateDisplay();
                            visualizeAIDecision();
                        } else {
                            // –í—Å—ñ —Ä—É–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ñ
                            dealerPlay();
                        }
                    }
                    break;
                    
                case 'stand':
                    addLog('–ì—Ä–∞–≤–µ—Ü—å –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è', 'info');
                    if (currentHandIndex < playerHands.length - 1) {
                        currentHandIndex++;
                        updateDisplay();
                        visualizeAIDecision();
                    } else {
                        dealerPlay();
                    }
                    break;
                    
                case 'double':
                    if (balance >= currentBet) {
                        balance -= currentBet;
                        currentHand.push(draw());
                        addLog(`–ü–æ–¥–≤—ñ–π–Ω–∞ —Å—Ç–∞–≤–∫–∞! –©–µ –∫–∞—Ä—Ç–∞: ${currentHand[currentHand.length-1].name}`, 'info');
                        
                        if (currentHandIndex < playerHands.length - 1) {
                            currentHandIndex++;
                            updateDisplay();
                            visualizeAIDecision();
                        } else {
                            dealerPlay();
                        }
                    } else {
                        addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –ø–æ–¥–≤—ñ–π–Ω–æ—ó', 'error');
                    }
                    break;
                    
                case 'split':
                    if (balance >= currentBet) {
                        balance -= currentBet;
                        const card1 = currentHand[0];
                        const card2 = currentHand[1];
                        
                        // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–≤—ñ —Ä—É–∫–∏
                        playerHands[currentHandIndex] = [card1, draw()];
                        playerHands.push([card2, draw()]);
                        
                        addLog('–°–ø–ª—ñ—Ç! –†–æ–∑–¥—ñ–ª—è—î–º–æ –∫–∞—Ä—Ç–∏', 'info');
                        updateStats();
                    } else {
                        addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è —Å–ø–ª—ñ—Ç—É', 'error');
                    }
                    break;
            }
            
            updateDisplay();
            updateStats();
            updateControls();
        }

        // === –•–Ü–î –î–ò–õ–ï–†–ê ===
        function dealerPlay() {
            gameState = 'dealer';
            updateDisplay();
            addLog('–•—ñ–¥ –¥–∏–ª–µ—Ä–∞...', 'info');
            
            function play() {
                if (calcScore(dealerHand) < 17) {
                    dealerHand.push(draw());
                    updateDisplay();
                    setTimeout(play, 600);
                } else {
                    determineWinner();
                }
            }
            
            setTimeout(play, 600);
        }

        // === –í–ò–ó–ù–ê–ß–ï–ù–ù–Ø –ü–ï–†–ï–ú–û–ñ–¶–Ø ===
        function determineWinner() {
            const dScore = calcScore(dealerHand);
            let roundProfit = 0;
            
            playerHands.forEach((hand, idx) => {
                const pScore = calcScore(hand);
                
                if (pScore > 21) {
                    // –ü—Ä–æ–≥—Ä–∞—à
                    stats.losses++;
                    addLog(`–†—É–∫–∞ ${idx+1}: –ø–µ—Ä–µ–±—ñ—Ä ‚Üí –ø—Ä–æ–≥—Ä–∞—à`, 'error');
                } else if (dScore > 21 || pScore > dScore) {
                    // –í–∏–≥—Ä–∞—à
                    const winAmount = currentBet * 2;
                    balance += winAmount;
                    roundProfit += currentBet;
                    stats.wins++;
                    addLog(`–†—É–∫–∞ ${idx+1}: –≤–∏–≥—Ä–∞—à! +‚Ç¥${currentBet}`, 'success');
                } else if (pScore === dScore) {
                    // –ù—ñ—á–∏—è - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∞–≤–∫—É
                    balance += currentBet;
                    stats.pushes++;
                    addLog(`–†—É–∫–∞ ${idx+1}: –Ω—ñ—á–∏—è`, 'info');
                } else {
                    // –ü—Ä–æ–≥—Ä–∞—à
                    stats.losses++;
                    addLog(`–†—É–∫–∞ ${idx+1}: –ø—Ä–æ–≥—Ä–∞—à`, 'error');
                }
            });
            
            stats.totalGames++;
            
            if (roundProfit > 0) {
                autoPlayStats.currentStreak = Math.max(0, autoPlayStats.currentStreak) + 1;
            } else if (roundProfit < 0) {
                autoPlayStats.currentStreak = Math.min(0, autoPlayStats.currentStreak) - 1;
            }
            
            endRound('finished');
        }

        function endRound(result) {
            gameState = 'finished';
            updateStats();
            updateControls();
            updateDisplay();
            addLog(`–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ë–∞–ª–∞–Ω—Å: ‚Ç¥${balance}`, 'info');
        }

        // === AI –ê–ù–ê–õ–Ü–ó ===
        async function visualizeAIDecision() {
            if (!tfModel || playerHand.length < 2) return null;
            
            const state = getCurrentState();
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ
            const input = tf.tensor2d([[
                state.playerScore / 21,
                state.dealerCard / 11,
                state.canSplit ? 1 : 0,
                state.canDouble ? 1 : 0,
                state.isSoft ? 1 : 0,
                state.numCards / 8,
                trueCount / 10,
                deck.length / 416,
                state.playerScore > 17 ? 1 : 0,
                state.dealerCard >= 7 ? 1 : 0,
                state.playerScore <= 11 ? 1 : 0,
                (state.playerScore - state.dealerCard) / 20,
                state.isSoft && state.playerScore >= 18 ? 1 : 0,
                state.canDouble && state.playerScore >= 9 && state.playerScore <= 11 ? 1 : 0,
                trueCount > 1 ? 1 : 0
            ]]);

            const pred = tfModel.predict(input);
            const probs = await pred.data();
            input.dispose();
            pred.dispose();

            const actions = ['hit', 'stand', 'double', 'split'];
            const masks = [true, true, state.canDouble, state.canSplit];
            
            // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ
            const validProbs = probs.map((p, i) => masks[i] ? p : 0);
            const sum = validProbs.reduce((a,b) => a+b, 0);
            const normalized = validProbs.map(p => sum > 0 ? p / sum : 0);
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –¥—ñ—é –∑ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ—ó —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
            const optimizedAction = getOptimizedStrategyAction(state);
            const maxProb = Math.max(...normalized);
            const bestAction = optimizedAction || actions[normalized.indexOf(maxProb)];

            // –û–Ω–æ–≤–ª—é—î–º–æ UI
            document.querySelectorAll('.decision-cell').forEach(cell => {
                cell.classList.remove('selected');
                cell.style.opacity = '0.5';
            });

            normalized.forEach((prob, idx) => {
                const cell = document.getElementById('cell-' + actions[idx]);
                const probDiv = document.getElementById('prob-' + actions[idx]);
                probDiv.textContent = (prob * 100).toFixed(1) + '%';
                
                if (masks[idx]) {
                    cell.style.opacity = Math.max(0.3, prob * 1.5);
                    if (actions[idx] === bestAction) {
                        cell.classList.add('selected');
                    }
                } else {
                    cell.style.opacity = '0.2';
                    probDiv.textContent = 'N/A';
                }
            });

            // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–∞–∫—Ç–æ—Ä–∏ —Ä—ñ—à–µ–Ω–Ω—è
            showReasoning(state, normalized, bestAction, optimizedAction !== null);
            document.getElementById('vizStatus').textContent = `–†—ñ—à–µ–Ω–Ω—è: ${bestAction.toUpperCase()}`;
            
            return { bestAction, confidence: maxProb };
        }

        function getOptimizedStrategyAction(state) {
            const {playerScore, dealerCard, canSplit, canDouble, isSoft} = state;
            const dCard = dealerCard === 11 ? 'A' : dealerCard.toString();
            
            let strategyTable, key;
            
            if (canSplit && canSplitHand(playerHands[currentHandIndex])) {
                strategyTable = optimizedStrategy.pairs;
                const cardValue = playerHands[currentHandIndex][0].value;
                if (cardValue === 11) key = 'A,A';
                else if (cardValue === 10) key = '10,10';
                else key = `${cardValue},${cardValue}`;
            } else if (isSoft) {
                strategyTable = optimizedStrategy.soft;
                const secondCard = playerScore - 11;
                key = `A${secondCard}`;
            } else {
                strategyTable = optimizedStrategy.hard;
                key = Math.min(20, Math.max(8, playerScore));
            }
            
            if (strategyTable[key] && strategyTable[key][dCard]) {
                const action = strategyTable[key][dCard];
                if (action === 'H') return 'hit';
                if (action === 'S') return 'stand';
                if (action === 'D' && canDouble) return 'double';
                if (action === 'SP' && canSplit) return 'split';
            }
            
            return null;
        }

        function showReasoning(state, probs, bestAction, isOptimized) {
            const box = document.getElementById('reasoningBox');
            const list = document.getElementById('factorsList');
            
            const factors = [
                { name: '–û—á–∫–∏ –≥—Ä–∞–≤—Ü—è', value: state.playerScore, weight: state.playerScore > 17 ? '–í–∏—Å–æ–∫—ñ - –∫—Ä–∞—â–µ —Å—Ç–æ—è—Ç–∏' : '–ù–∏–∑—å–∫—ñ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∫–∞—Ä—Ç–∞' },
                { name: '–ö–∞—Ä—Ç–∞ –¥–∏–ª–µ—Ä–∞', value: state.dealerCard, weight: state.dealerCard >= 7 ? '–°–∏–ª—å–Ω–∞ - —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–æ' : '–°–ª–∞–±–∫–∞ - –º–æ–∂–Ω–∞ –≥—Ä–∞—Ç–∏' },
                { name: 'True Count', value: trueCount.toFixed(1), weight: trueCount > 0 ? '–ü–æ–∑–∏—Ç–∏–≤–Ω–∏–π (+ —Å—Ç–∞–≤–∫–∞)' : '–ù–µ–≥–∞—Ç–∏–≤–Ω–∏–π' },
                { name: '–ö–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥—ñ', value: deck.length, weight: deck.length > 200 ? '–ë–∞–≥–∞—Ç–æ' : '–ú–∞–ª–æ' },
                { name: '–°—Ç—Ä–∞—Ç–µ–≥—ñ—è', value: isOptimized ? '–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞' : '–ë–∞–∑–æ–≤–∞', weight: isOptimized ? 'AI –ø–æ–∫—Ä–∞—â–∏–≤' : '–ö–ª–∞—Å–∏—á–Ω–∞' }
            ];

            list.innerHTML = factors.map(f => `
                <div class="factor-row">
                    <span style="color: ${f.name === '–°—Ç—Ä–∞—Ç–µ–≥—ñ—è' && isOptimized ? '#00ff88' : '#aaa'};">${f.name}:</span>
                    <span style="color: #fff; font-weight: bold;">${f.value}</span>
                </div>
                <div style="font-size: 8px; color: #4ecdc4; margin-bottom: 4px; padding-left: 10px;">
                    ‚Üí ${f.weight}
                </div>
            `).join('');

            box.style.display = 'block';
        }

        // === –û–ù–û–í–õ–ï–ù–ù–Ø –Ü–ù–¢–ï–†–§–ï–ô–°–£ ===
        function updateDisplay() {
            const currentHand = playerHands[currentHandIndex] || playerHand;
            
            // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç –≥—Ä–∞–≤—Ü—è
            if (playerHands.length > 1) {
                let playerHtml = '';
                playerHands.forEach((hand, idx) => {
                    const isActive = idx === currentHandIndex;
                    playerHtml += `<div style="opacity: ${isActive ? 1 : 0.5}; border: ${isActive ? '2px solid #00ff88' : 'none'}; border-radius: 10px; padding: 4px;">`;
                    playerHtml += hand.map(c => renderCard(c)).join('');
                    playerHtml += `<div style="text-align: center; font-size: 11px; color: ${isActive ? '#00ff88' : '#888'};">${calcScore(hand)}</div>`;
                    playerHtml += '</div>';
                });
                document.getElementById('playerCards').innerHTML = playerHtml;
            } else {
                document.getElementById('playerCards').innerHTML = playerHand.map(c => renderCard(c)).join('');
            }
            
            document.getElementById('playerScore').textContent = currentHand ? calcScore(currentHand) : '--';
            
            // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç –¥–∏–ª–µ—Ä–∞
            const dealerHtml = dealerHand.map((c, i) => 
                renderCard(c, gameState === 'playing' && i === 1)
            ).join('');
            document.getElementById('dealerCards').innerHTML = dealerHtml || '<div class="card card-back"></div>';
            
            const dScore = calcScore(dealerHand);
            document.getElementById('dealerScore').textContent = 
                gameState === 'playing' ? (dealerHand[0] ? dealerHand[0].value : '--') : dScore;
        }

        function renderCard(card, hidden = false) {
            if (!card) return '<div class="card card-back"></div>';
            if (hidden) return '<div class="card card-back"></div>';
            
            const cls = card.isRed ? 'red' : 'black';
            return `<div class="card ${cls}">
                <div style="font-size:10px">${card.name}${card.suit}</div>
                <div class="card-center">${card.suit}</div>
                <div style="font-size:10px;transform:rotate(180deg)">${card.name}${card.suit}</div>
            </div>`;
        }

        function updateStats() {
            // –ë–∞–ª–∞–Ω—Å
            document.getElementById('balanceValue').textContent = '‚Ç¥' + Math.floor(balance);
            document.getElementById('balanceSub').textContent = 'TC: ' + trueCount.toFixed(1);
            
            // –ü—Ä–∏–±—É—Ç–æ–∫ (–≤—ñ–¥ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å—É)
            const profit = balance - startingBalance;
            const profitEl = document.getElementById('profitValue');
            profitEl.textContent = (profit >= 0 ? '+' : '') + '‚Ç¥' + Math.floor(profit);
            profitEl.className = 'stat-value ' + (profit >= 0 ? 'positive' : profit < 0 ? 'negative' : 'neutral');
            
            const profitPercentEl = document.getElementById('profitPercent');
            const profitPercent = startingBalance > 0 ? (profit / startingBalance * 100) : 0;
            profitPercentEl.textContent = (profitPercent > 0 ? '+' : '') + profitPercent.toFixed(1) + '%';
            profitPercentEl.style.color = profit >= 0 ? '#00ff88' : '#ff6b6b';
            
            // –¢–æ—á–Ω—ñ—Å—Ç—å AI
            const accuracy = stats.totalDecisions > 0 ? (stats.correctDecisions / stats.totalDecisions * 100) : 0;
            document.getElementById('accuracyValue').textContent = accuracy.toFixed(1) + '%';
            document.getElementById('gamesCount').textContent = stats.totalGames + ' —ñ–≥–æ—Ä';
        }

        function updateControls() {
            if (isAutoPlaying) return;
            
            const controlArea = document.getElementById('controlArea');
            const activeTab = document.querySelector('.tab-btn.active')?.id || 'tabManual';
            
            if (gameState === 'playing') {
                // –†–µ–∂–∏–º –≥—Ä–∏ - –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫–∏ –¥—ñ–π
                controlArea.className = 'control-grid four-cols';
                const state = getCurrentState();
                
                controlArea.innerHTML = `
                    <button class="big-btn btn-hit" onclick="playerAction('hit')">–í–ó–Ø–¢–ò</button>
                    <button class="big-btn btn-stand" onclick="playerAction('stand')">–°–¢–û–ü</button>
                    <button class="big-btn btn-double" onclick="playerAction('double')" ${!state.canDouble ? 'disabled' : ''}>–ü–û–î–í.</button>
                    <button class="big-btn btn-split" onclick="playerAction('split')" ${!state.canSplit ? 'disabled' : ''}>–°–ü–õ–Ü–¢</button>
                `;
            } else {
                // –†–µ–∂–∏–º –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
                controlArea.className = 'control-grid';
                
                if (activeTab === 'tabManual') {
                    controlArea.innerHTML = `
                        <button class="big-btn btn-deal" onclick="newRound()">üé≤ –ù–û–í–ê –ì–†–ê</button>
                        <button class="big-btn btn-autoplay" onclick="startAutoPlay()">ü§ñ –ê–í–¢–û–ì–†–ê</button>
                    `;
                } else if (activeTab === 'tabTrain') {
                    controlArea.innerHTML = `
                        <button class="big-btn btn-train" onclick="startSelfPlay()">üéì –ù–ê–í–ß–ê–ù–ù–Ø</button>
                        <button class="big-btn btn-optimize" onclick="startSelfPlay()">üìä –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø</button>
                    `;
                }
            }
        }

        function setMode(mode) {
            if (isAutoPlaying) {
                addLog('–ó—É–ø–∏–Ω—ñ—Ç—å –∞–≤—Ç–æ–≥—Ä—É —Å–ø–æ—á–∞—Ç–∫—É', 'error');
                return;
            }
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            
            gameState = 'idle';
            updateControls();
        }

        // === –ê–í–¢–û–ì–†–ê ===
        async function startAutoPlay() {
            if (isAutoPlaying) return;
            
            if (balance < currentBet) {
                addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–≥—Ä–∏!', 'error');
                showDepositModal();
                return;
            }

            isAutoPlaying = true;
            autoPlayPaused = false;
            autoPlayStats.startBalance = balance;
            autoPlayStats.gamesPlayed = 0;
            autoPlayStats.totalWon = 0;
            autoPlayStats.totalLost = 0;
            autoPlayStats.currentStreak = 0;
            
            document.getElementById('autoPlayPanel').style.display = 'block';
            document.getElementById('systemStatus').textContent = 'ü§ñ –ê–≤—Ç–æ–≥—Ä–∞';
            document.getElementById('systemStatus').className = 'status-badge autoplay';
            
            addLog('ü§ñ AI –ø–æ—á–∏–Ω–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –≥—Ä—É!', 'autoplay');
            
            while (isAutoPlaying && balance >= currentBet) {
                if (autoPlayPaused) {
                    await new Promise(r => setTimeout(r, 100));
                    continue;
                }
                
                await autoPlayRound();
                updateAutoPlayStats();
                
                const delay = [2000, 1500, 1000, 600, 300][autoPlaySpeed - 1];
                await new Promise(r => setTimeout(r, delay));
            }
            
            if (balance < currentBet) {
                addLog('–ê–≤—Ç–æ–≥—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤', 'error');
                stopAutoPlay();
            }
        }

        async function autoPlayRound() {
            // –°–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –¥–ª—è –∞–≤—Ç–æ–≥—Ä–∏
            playerHands = [];
            currentHandIndex = 0;
            
            balance -= currentBet;
            dealerHand = [draw(), draw()];
            playerHand = [draw(), draw()];
            playerHands.push([...playerHand]);
            
            gameState = 'playing';
            autoPlayStats.gamesPlayed++;
            
            updateDisplay();
            updateStats();
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–ª–µ–∫–¥–∂–µ–∫–∞
            if (checkBlackjack()) return;
            
            // AI –≥—Ä–∞—î
            while (currentHandIndex < playerHands.length) {
                const currentHand = playerHands[currentHandIndex];
                let handComplete = false;
                
                while (!handComplete && isAutoPlaying) {
                    const decision = await visualizeAIDecision();
                    if (!decision) break;
                    
                    const action = decision.bestAction;
                    
                    // –Ü–º—ñ—Ç—É—î–º–æ –¥—ñ—é
                    if (action === 'hit') {
                        currentHand.push(draw());
                        if (calcScore(currentHand) > 21) handComplete = true;
                    } else if (action === 'stand') {
                        handComplete = true;
                    } else if (action === 'double' && balance >= currentBet) {
                        balance -= currentBet;
                        currentHand.push(draw());
                        handComplete = true;
                    } else if (action === 'split' && balance >= currentBet && canSplitHand(currentHand)) {
                        balance -= currentBet;
                        const card1 = currentHand[0];
                        const card2 = currentHand[1];
                        playerHands[currentHandIndex] = [card1, draw()];
                        playerHands.push([card2, draw()]);
                    }
                    
                    updateDisplay();
                    await new Promise(r => setTimeout(r, 300));
                }
                
                currentHandIndex++;
            }
            
            // –•—ñ–¥ –¥–∏–ª–µ—Ä–∞
            gameState = 'dealer';
            updateDisplay();
            
            while (calcScore(dealerHand) < 17) {
                await new Promise(r => setTimeout(r, 400));
                dealerHand.push(draw());
                updateDisplay();
            }
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–µ—Ä–µ–º–æ–∂—Ü—è
            determineWinner();
        }

        function updateAutoPlayStats() {
            document.getElementById('autoGames').textContent = autoPlayStats.gamesPlayed;
            const netProfit = autoPlayStats.totalWon - autoPlayStats.totalLost;
            const profitEl = document.getElementById('autoWinAmount');
            profitEl.textContent = (netProfit >= 0 ? '+' : '') + '‚Ç¥' + Math.floor(netProfit);
            profitEl.style.color = netProfit >= 0 ? '#00ff88' : '#ff6b6b';
            
            const streakEl = document.getElementById('autoStreak');
            streakEl.textContent = (autoPlayStats.currentStreak > 0 ? '+' : '') + autoPlayStats.currentStreak;
            streakEl.style.color = autoPlayStats.currentStreak > 0 ? '#00ff88' : autoPlayStats.currentStreak < 0 ? '#ff6b6b' : '#ffd700';
        }

        function stopAutoPlay() {
            isAutoPlaying = false;
            autoPlayPaused = false;
            
            document.getElementById('autoPlayPanel').style.display = 'none';
            document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
            document.getElementById('systemStatus').className = 'status-badge ready';
            
            updateControls();
            addLog('–ê–≤—Ç–æ–≥—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞', 'info');
        }

        function toggleAutoPause() {
            autoPlayPaused = !autoPlayPaused;
            const btn = document.getElementById('pauseBtn');
            if (autoPlayPaused) {
                btn.textContent = '‚ñ∂ –ü–†–û–î–û–í–ñ–ò–¢–ò';
                btn.style.background = '#00ff88';
                document.getElementById('autoPlayStatus').textContent = '–ü–∞—É–∑–∞';
            } else {
                btn.textContent = '‚è∏ –ü–ê–£–ó–ê';
                btn.style.background = '#4ecdc4';
                document.getElementById('autoPlayStatus').textContent = '–ì—Ä–∞—î...';
            }
        }

        // === –ù–ê–í–ß–ê–ù–ù–Ø ===
        async function startSelfPlay() {
            if (isSelfPlaying) {
                isSelfPlaying = false;
                document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
                document.getElementById('systemStatus').className = 'status-badge ready';
                document.getElementById('learningStatus').style.display = 'none';
                addLog('–ù–∞–≤—á–∞–Ω–Ω—è –∑—É–ø–∏–Ω–µ–Ω–æ', 'info');
                return;
            }

            isSelfPlaying = true;
            document.getElementById('systemStatus').textContent = 'ü§ñ –ù–∞–≤—á–∞–Ω–Ω—è';
            document.getElementById('systemStatus').className = 'status-badge selfplay';
            document.getElementById('learningStatus').style.display = 'block';
            document.getElementById('learningIndicator').style.display = 'inline-block';

            addLog('–ü–æ—á–∏–Ω–∞—î–º–æ —Å–∞–º–æ–Ω–∞–≤—á–∞–Ω–Ω—è AI...', 'ai');

            // –°–∏–º—É–ª—è—Ü—ñ—ó
            optimizationData.simulationsRun = 0;
            optimizationData.rulesChanged = 0;
            
            for (let i = 0; i < 1000 && isSelfPlaying; i++) {
                optimizationData.simulationsRun++;
                
                // –í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
                if (Math.random() > 0.95) {
                    optimizationData.rulesChanged++;
                }
                
                if (i % 100 === 0) {
                    document.getElementById('learningProgress').style.width = (i / 10) + '%';
                    document.getElementById('simCount').textContent = optimizationData.simulationsRun;
                    document.getElementById('ruleChanges').textContent = optimizationData.rulesChanged;
                    await new Promise(r => setTimeout(r, 10));
                }
            }

            optimizationData.baseStrategyROI = -0.8;
            optimizationData.optimizedROI = 1.2;
            
            document.getElementById('optimizationStats').style.display = 'block';
            document.getElementById('scenariosTested').textContent = optimizationData.simulationsRun;
            document.getElementById('improvementsFound').textContent = optimizationData.rulesChanged;
            document.getElementById('baseROI').textContent = optimizationData.baseStrategyROI.toFixed(2) + '%';
            document.getElementById('optimizedROI').textContent = (optimizationData.optimizedROI > 0 ? '+' : '') + optimizationData.optimizedROI.toFixed(2) + '%';

            isSelfPlaying = false;
            document.getElementById('systemStatus').textContent = '‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ';
            document.getElementById('systemStatus').className = 'status-badge ready';
            document.getElementById('learningStatus').style.display = 'none';
            document.getElementById('learningIndicator').style.display = 'none';

            addLog(`–ù–∞–≤—á–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`, 'success');
        }

        // === –¢–ê–ë–õ–ò–¶–Ø –°–¢–†–ê–¢–ï–ì–Ü–á ===
        function generateStrategyTable() {
            const container = document.getElementById('tableContainer');
            const dealerCards = [2, 3, 4, 5, 6, 7, 8, 9, 10, 'A'];
            
            let html = '<table class="full-strategy-table"><tr><th></th>';
            dealerCards.forEach(dc => html += `<th>${dc}</th>`);
            html += '</tr>';

            const data = optimizedStrategy[currentTableView];
            
            for (let [playerHand, actions] of Object.entries(data)) {
                html += `<tr><td class="header-col">${playerHand}</td>`;
                for (let dc of dealerCards) {
                    const action = actions[dc];
                    const cellClass = action === 'H' ? 'cell-h' : action === 'S' ? 'cell-s' : action === 'D' ? 'cell-d' : 'cell-sp';
                    html += `<td class="${cellClass}">${action}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</table>';
            container.innerHTML = html;
        }

        function switchTableView(view) {
            currentTableView = view;
            generateStrategyTable();
        }

        function resetToBasicStrategy() {
            optimizedStrategy = JSON.parse(JSON.stringify(baseStrategy));
            generateStrategyTable();
            addLog('–°—Ç—Ä–∞—Ç–µ–≥—ñ—é —Å–∫–∏–Ω—É—Ç–æ –¥–æ –±–∞–∑–æ–≤–æ—ó', 'info');
        }

        function exportStrategy() {
            addLog('–°—Ç—Ä–∞—Ç–µ–≥—ñ—é –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª—å', 'success');
            console.log('Optimized Strategy:', optimizedStrategy);
        }

        // === –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê ===
        function showFullTable() {
            generateStrategyTable();
            document.getElementById('tableModal').classList.add('show');
        }

        function hideTableModal() {
            document.getElementById('tableModal').classList.remove('show');
        }

        function showDepositModal() {
            document.getElementById('depositModal').classList.add('show');
        }

        function hideDepositModal() {
            document.getElementById('depositModal').classList.remove('show');
        }

        function confirmDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            if (amount && amount >= 100) {
                balance += amount;
                startingBalance += amount; // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ø—Ä–∏–±—É—Ç–∫—É
                updateStats();
                hideDepositModal();
                addLog(`–ü–æ–ø–æ–≤–Ω–µ–Ω–æ: +‚Ç¥${amount}`, 'success');
                document.getElementById('depositAmount').value = '';
            } else {
                addLog('–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—É–º–∞ 100‚Ç¥', 'error');
            }
        }

        // === –°–¢–ê–í–ö–ò ===
        function changeBet(delta) {
            const newBet = currentBet + delta;
            if (newBet >= 50 && newBet <= 10000 && newBet <= balance) {
                currentBet = newBet;
                document.getElementById('currentBetInput').value = currentBet;
            }
        }

        function updateBetFromInput() {
            const val = parseInt(document.getElementById('currentBetInput').value);
            if (val >= 50 && val <= 10000 && val <= balance) {
                currentBet = val;
            } else {
                document.getElementById('currentBetInput').value = currentBet;
            }
        }

        function toggleSideBet(type) {
            const toggle = document.getElementById(type + 'Toggle');
            sideBets[type].active = !sideBets[type].active;
            toggle.classList.toggle('active', sideBets[type].active);
            
            if (sideBets[type].active && sideBets[type].amount === 0) {
                sideBets[type].amount = 50;
                document.getElementById(type + 'Bet').value = 50;
            }
            updateTotalSideBets();
        }

        function updateSideBet(type) {
            const amount = parseInt(document.getElementById(type + 'Bet').value) || 0;
            sideBets[type].amount = Math.min(5000, Math.max(0, amount));
            updateTotalSideBets();
        }

        function updateTotalSideBets() {
            const total = Object.values(sideBets).reduce((sum, sb) => sum + (sb.active ? sb.amount : 0), 0);
            document.getElementById('totalSideBets').textContent = '‚Ç¥' + total;
        }

        // === –õ–û–ì ===
        function addLog(msg, type) {
            const consoleLog = document.getElementById('consoleLog');
            const line = document.createElement('div');
            line.className = 'log-line log-' + type;
            line.textContent = new Date().toLocaleTimeString('uk-UA', {hour:'2-digit', minute:'2-digit', second:'2-digit'}) + ' | ' + msg;
            consoleLog.appendChild(line);
            consoleLog.scrollTop = consoleLog.scrollHeight;
            
            while (consoleLog.children.length > 30) {
                consoleLog.removeChild(consoleLog.firstChild);
            }
        }
    </script>
</body>
</html>
