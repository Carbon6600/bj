<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blackjack AI Pro - Firebase Integration</title>
    <!-- TensorFlow -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, #0a1f2f 0%, #0b2b3b 100%);
            height: 100vh;
            height: 100dvh;
            color: #fff;
            overflow: hidden;
            position: fixed;
            width: 100%;
            font-size: 14px;
        }

        .game-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 6px;
            gap: 4px;
            max-width: 430px;
            margin: 0 auto;
            background: rgba(0,30,30,0.3);
            border-radius: 24px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a1f2f;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .loading-screen.hidden { display: none; }

        .loading-spinner {
            width: 44px;
            height: 44px;
            border: 4px solid rgba(78,205,196,0.2);
            border-top-color: #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 14px;
            border-radius: 30px;
            border: 1px solid #4ecdc4;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .header-title { 
            font-size: 16px; 
            font-weight: 700; 
            background: linear-gradient(135deg, #4ecdc4, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 11px;
            font-weight: 600;
            background: #ff6b6b;
            color: #fff;
        }

        .status-badge.ready { background: #4ecdc4; color: #000; }
        .status-badge.training { background: #ffd700; color: #000; animation: pulse 1s infinite; }
        .status-badge.autoplay { background: #ff6b6b; animation: pulse 0.3s infinite; }
        .status-badge.learning { background: #bc13fe; animation: pulse 0.5s infinite; }
        .status-badge.saving { background: #00ff88; color: #000; animation: pulse 0.5s infinite; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* Firebase —Å—Ç–∞—Ç—É—Å */
        .firebase-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 9px;
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: 5px;
        }

        .firebase-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff6b6b;
        }

        .firebase-dot.connected {
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        /* –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–ª–æ–¥–∏ */
        .deck-visualization {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #4ecdc4;
            border-radius: 20px;
            padding: 8px 12px;
            backdrop-filter: blur(4px);
        }

        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .deck-title {
            font-size: 11px;
            color: #4ecdc4;
            text-transform: uppercase;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .deck-cards-left {
            background: rgba(78,205,196,0.2);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            color: #4ecdc4;
        }

        .deck-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .temperature-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .temperature-fill {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #00ff88, #ffd700, #ff6b6b);
            transition: width 0.3s;
        }

        .temperature-label {
            font-size: 10px;
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }

        .deck-cards-preview {
            display: flex;
            gap: 2px;
            margin-top: 6px;
            padding: 4px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow-x: auto;
        }

        .mini-card {
            width: 22px;
            height: 30px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            border-radius: 4px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            flex-shrink: 0;
            font-weight: 700;
        }

        .mini-card.red { color: #d32f2f; }
        .mini-card.back {
            background: linear-gradient(135deg, #b71c1c, #7f0000);
            border: 1px solid #ffd700;
        }

        /* AI –ø–∞–Ω–µ–ª—å */
        .ai-viz-panel {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00ff88;
            border-radius: 20px;
            padding: 10px;
        }

        .ai-viz-title {
            font-size: 11px;
            color: #00ff88;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .decision-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }

        .decision-cell {
            padding: 8px 2px;
            border-radius: 14px;
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .decision-cell.hit { background: #2e7d32; }
        .decision-cell.stand { background: #c62828; }
        .decision-cell.double { background: #6a1b9a; }
        .decision-cell.split { background: #f9a825; color: #000; }
        .decision-cell.selected {
            box-shadow: 0 0 15px #00ff88;
            transform: scale(1.05);
            border: 2px solid #fff;
        }

        .decision-cell .prob {
            font-size: 8px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .reasoning-box {
            background: rgba(0,255,136,0.1);
            border-radius: 14px;
            padding: 8px;
            font-size: 10px;
            border: 1px solid rgba(0,255,136,0.3);
        }

        .reasoning-title {
            color: #00ff88;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .factor-row {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 18px;
            padding: 8px 6px;
            text-align: center;
            border: 1px solid #ffd700;
            position: relative;
            backdrop-filter: blur(4px);
        }

        .stat-title { 
            font-size: 9px; 
            color: #aaa; 
            text-transform: uppercase; 
        }
        
        .stat-value { 
            font-size: 16px; 
            font-weight: 700; 
            margin-top: 2px;
        }
        
        .stat-value.positive { color: #00ff88; }
        .stat-value.negative { color: #ff6b6b; }
        .stat-value.neutral { color: #ffd700; }
        
        .stat-sub { 
            font-size: 9px; 
            color: #aaa; 
            margin-top: 2px;
        }

        .deposit-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: #00ff88;
            border: none;
            border-radius: 50%;
            color: #000;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –ê–≤—Ç–æ–≥—Ä–∞ –ø–∞–Ω–µ–ª—å */
        .auto-play-panel {
            background: rgba(255,107,107,0.2);
            border: 2px solid #ff6b6b;
            border-radius: 20px;
            padding: 12px;
            backdrop-filter: blur(4px);
            display: none;
            margin-bottom: 4px;
        }

        .auto-play-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .auto-play-title {
            color: #ff6b6b;
            font-size: 13px;
            font-weight: 700;
        }

        .auto-play-status {
            font-size: 12px;
            color: #ff6b6b;
            animation: blink 1s infinite;
            font-weight: 600;
        }

        .auto-play-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        .auto-stat {
            background: rgba(0,0,0,0.4);
            padding: 8px 4px;
            border-radius: 14px;
            text-align: center;
        }

        .auto-stat-value {
            color: #ff6b6b;
            font-weight: 700;
            font-size: 14px;
        }

        .auto-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .auto-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
        }

        .auto-btn-stop { background: #ffd700; color: #000; }
        .auto-btn-pause { background: #4ecdc4; color: #000; }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .speed-slider {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #ff6b6b;
            border-radius: 50%;
            cursor: pointer;
        }

        /* –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏ */
        .side-bets-panel {
            background: rgba(255,107,107,0.1);
            border: 1px solid #ff6b6b;
            border-radius: 20px;
            padding: 10px;
        }

        .panel-title { 
            color: #ff6b6b; 
            font-size: 11px; 
            font-weight: 600;
            margin-bottom: 8px; 
            display: flex; 
            justify-content: space-between; 
        }

        .side-bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 14px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .side-bet-toggle {
            width: 40px;
            height: 22px;
            background: rgba(255,255,255,0.2);
            border-radius: 11px;
            position: relative;
            cursor: pointer;
        }

        .side-bet-toggle.active { background: #ff6b6b; }
        .side-bet-toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.2s;
        }
        .side-bet-toggle.active::after { left: 20px; }

        .side-bet-amount {
            width: 55px;
            padding: 4px 6px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #ff6b6b;
            border-radius: 10px;
            color: #fff;
            font-size: 11px;
            text-align: center;
        }

        /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞–≤–æ–∫ */
        .betting-panel {
            background: rgba(255,215,0,0.1);
            border: 1px solid #ffd700;
            border-radius: 20px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .bet-btn {
            width: 34px;
            height: 34px;
            border: none;
            border-radius: 12px;
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
        }

        .bet-input {
            width: 75px;
            padding: 6px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #ffd700;
            border-radius: 10px;
            color: #fff;
            text-align: center;
            font-size: 13px;
        }

        /* –Ü–≥—Ä–æ–≤–∞ –∑–æ–Ω–∞ */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-height: 0;
        }

        .game-box {
            background: rgba(0, 40, 20, 0.5);
            border-radius: 24px;
            padding: 10px;
            border: 1px solid #ffd700;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .box-title { 
            font-size: 13px; 
            color: #ffd700; 
            font-weight: 700;
        }
        
        .score-pill {
            background: #ffd700;
            color: #000;
            padding: 4px 14px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 700;
        }

        .cards-area {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
            flex: 1;
            align-items: center;
            min-height: 80px;
        }

        .card {
            width: 52px;
            height: 74px;
            background: #fff;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            font-size: 13px;
            font-weight: 700;
            position: relative;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        @media (max-width: 380px) {
            .card { width: 46px; height: 66px; font-size: 11px; }
        }

        .card.red { color: #d32f2f; }
        .card.black { color: #212121; }
        .card-back {
            background: linear-gradient(135deg, #b71c1c, #7f0000);
            border: 2px solid #ffd700;
        }

        .card-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è */
        .controls {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 24px;
            padding: 12px;
            border: 1px solid #4ecdc4;
        }

        .mode-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            color: #aaa;
        }

        .tab-btn.active { 
            background: #4ecdc4; 
            color: #000;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .control-grid.four-cols {
            grid-template-columns: repeat(4, 1fr);
        }

        .big-btn {
            padding: 14px 6px;
            border: none;
            border-radius: 18px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .big-btn:active { transform: translateY(2px); }
        .big-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-deal { background: #4ecdc4; color: #000; }
        .btn-autoplay { background: #ff6b6b; color: #fff; }
        .btn-hit { background: #4ecdc4; color: #000; }
        .btn-stand { background: #ffd700; color: #000; }
        .btn-double { background: #6a1b9a; color: #fff; }
        .btn-split { background: #f9a825; color: #000; }
        .btn-learn { background: #bc13fe; color: #fff; }
        .btn-firebase { background: #FFA611; color: #000; }

        .console-log {
            background: rgba(0,0,0,0.5);
            border-radius: 16px;
            padding: 8px;
            font-size: 9px;
            max-height: 50px;
            overflow-y: auto;
            border: 1px solid #4ecdc4;
        }

        .log-success { color: #00ff88; }
        .log-error { color: #ff6b6b; }
        .log-info { color: #4ecdc4; }
        .log-autoplay { color: #ff6b6b; font-weight: bold; }
        .log-learning { color: #bc13fe; font-weight: bold; }
        .log-firebase { color: #FFA611; font-weight: bold; }

        /* –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            backdrop-filter: blur(5px);
        }

        .modal.show { 
            display: flex !important; 
        }

        .modal-content {
            background: linear-gradient(135deg, #1a3a3a, #0a2a2a);
            padding: 24px 20px;
            border-radius: 32px;
            border: 2px solid #4ecdc4;
            max-width: 95vw;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .modal-title { 
            color: #4ecdc4; 
            font-size: 20px; 
            font-weight: 700;
            margin-bottom: 16px; 
            text-align: center;
        }

        /* –ë–∞–∑–∞ –∑–Ω–∞–Ω—å AI */
        .knowledge-base {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .scenario-card {
            background: rgba(78,205,196,0.1);
            border-left: 3px solid #4ecdc4;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .scenario-card.learned {
            border-left: 3px solid #00ff88;
            background: rgba(0,255,136,0.05);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .scenario-cards {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .scenario-mini-card {
            width: 35px;
            height: 45px;
            background: #fff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: #000;
        }

        .scenario-mini-card.red { color: #d32f2f; }

        .decision-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .actual-decision {
            border-right: 1px solid rgba(255,255,255,0.2);
            padding-right: 10px;
        }

        .optimal-decision {
            padding-left: 10px;
        }

        .outcome-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 700;
        }

        .outcome-win { background: #00ff88; color: #000; }
        .outcome-loss { background: #ff6b6b; color: #fff; }
        .outcome-push { background: #ffd700; color: #000; }

        .win-rate-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .win-rate-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd700, #00ff88);
            transition: width 0.3s;
        }

        .learn-btn {
            background: #bc13fe;
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
        }

        .stat-box-value {
            font-size: 18px;
            font-weight: 700;
            color: #4ecdc4;
        }

        .training-progress {
            background: rgba(188,19,254,0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #4ecdc4, #bc13fe);
            transition: width 0.3s;
        }

        .loss-value {
            font-family: monospace;
            color: #ffd700;
            font-size: 14px;
        }

        .table-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .table-btn {
            flex: 1;
            padding: 10px 8px;
            background: rgba(78,205,196,0.2);
            border: 1px solid #4ecdc4;
            border-radius: 20px;
            color: #4ecdc4;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            min-width: 70px;
        }

        .table-btn.active {
            background: #4ecdc4;
            color: #000;
        }

        .modal-close-btn {
            background: #4ecdc4;
            color: #000;
            border: none;
            padding: 14px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 15px;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }

        .deposit-input {
            width: 100%;
            padding: 14px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #4ecdc4;
            border-radius: 20px;
            color: #fff;
            font-size: 15px;
            margin-bottom: 15px;
        }

        /* Firebase –ø–∞–Ω–µ–ª—å */
        .firebase-panel {
            background: rgba(255,166,17,0.1);
            border: 1px solid #FFA611;
            border-radius: 12px;
            padding: 8px;
            margin-top: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
        }

        .firebase-stats {
            display: flex;
            gap: 10px;
        }

        .firebase-stat {
            display: flex;
            align-items: center;
            gap: 3px;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div style="color: #4ecdc4; font-size: 16px;">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AI...</div>
    </div>

    <div class="game-wrapper">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div>
                <div class="header-title">‚ô†Ô∏è BLACKJACK FIREBASE</div>
                <div style="font-size: 9px; color: #aaa; display: flex; align-items: center;">
                    <span id="firebaseStatus" class="firebase-status">
                        <span class="firebase-dot" id="firebaseDot"></span>
                        <span id="firebaseText">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>
                    </span>
                </div>
            </div>
            <div class="status-badge" id="systemStatus">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
        </div>

        <!-- Firebase –ø–∞–Ω–µ–ª—å -->
        <div class="firebase-panel">
            <div class="firebase-stats">
                <div class="firebase-stat">
                    <span>üéÆ</span>
                    <span id="firebaseGames">0</span>
                </div>
                <div class="firebase-stat">
                    <span>üß†</span>
                    <span id="firebaseScenarios">0</span>
                </div>
                <div class="firebase-stat">
                    <span>üìä</span>
                    <span id="firebaseModels">0</span>
                </div>
            </div>
            <div>
                <button onclick="syncFromFirebase()" style="background: none; border: 1px solid #FFA611; color: #FFA611; border-radius: 12px; padding: 2px 8px; font-size: 9px; cursor: pointer;">‚Üª</button>
            </div>
        </div>

        <!-- –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–ª–æ–¥–∏ -->
        <div class="deck-visualization">
            <div class="deck-header">
                <div class="deck-title">
                    <span>üé¥ –ö–û–õ–û–î–ê</span>
                    <span class="deck-cards-left" id="deckCardsCount">312</span>
                </div>
                <div class="deck-indicator">
                    <div class="temperature-bar">
                        <div class="temperature-fill" id="deckTemperatureFill" style="width: 50%;"></div>
                    </div>
                    <span class="temperature-label" id="deckTemperatureLabel">‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞</span>
                </div>
            </div>
            <div class="deck-cards-preview" id="deckPreview">
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
                <div class="mini-card back"></div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <button class="deposit-btn" onclick="showDepositModal()">+</button>
                <div class="stat-title">–ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value neutral" id="balanceValue">‚Ç¥1000</div>
                <div class="stat-sub" id="balanceSub">TC: 0.0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–ü—Ä–∏–±—É—Ç–æ–∫</div>
                <div class="stat-value neutral" id="profitValue">‚Ç¥0</div>
                <div class="stat-sub" id="profitPercent">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–¢–æ—á–Ω—ñ—Å—Ç—å AI</div>
                <div class="stat-value neutral" id="accuracyValue">0%</div>
                <div class="stat-sub" id="gamesCount">0 —ñ–≥–æ—Ä</div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –∞–≤—Ç–æ–≥—Ä–∏ -->
        <div class="auto-play-panel" id="autoPlayPanel">
            <div class="auto-play-header">
                <span class="auto-play-title">ü§ñ –ê–í–¢–û–ì–†–ê AI</span>
                <span class="auto-play-status" id="autoPlayStatus">–ì—Ä–∞—î...</span>
            </div>
            <div class="auto-play-stats">
                <div class="auto-stat">
                    <div>–ó—ñ–≥—Ä–∞–Ω–æ</div>
                    <div class="auto-stat-value" id="autoGames">0</div>
                </div>
                <div class="auto-stat">
                    <div>–í–∏–≥—Ä–∞—à</div>
                    <div class="auto-stat-value" id="autoWinAmount">‚Ç¥0</div>
                </div>
                <div class="auto-stat">
                    <div>–°–µ—Ä—ñ—è</div>
                    <div class="auto-stat-value" id="autoStreak">0</div>
                </div>
            </div>
            <div class="speed-control">
                <span style="font-size: 11px;">–®–≤–∏–¥–∫—ñ—Å—Ç—å:</span>
                <input type="range" class="speed-slider" id="autoSpeed" min="1" max="5" value="3">
                <span style="font-size: 11px; min-width: 35px;" id="speedValue">3x</span>
            </div>
            <div class="auto-controls">
                <button class="auto-btn auto-btn-stop" onclick="stopAutoPlay()">‚èπ –ó–£–ü–ò–ù–ò–¢–ò</button>
                <button class="auto-btn auto-btn-pause" onclick="toggleAutoPause()" id="pauseBtn">‚è∏ –ü–ê–£–ó–ê</button>
            </div>
        </div>

        <!-- AI –ø–∞–Ω–µ–ª—å -->
        <div class="ai-viz-panel">
            <div class="ai-viz-title">
                <span>üß† AI –ê–Ω–∞–ª—ñ–∑</span>
                <span id="vizStatus">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è...</span>
            </div>
            
            <div class="decision-grid">
                <div class="decision-cell hit" id="cell-hit" onclick="if(!isAutoPlaying) playerAction('hit')">
                    HIT<br>–í–ó–Ø–¢–ò
                    <div class="prob" id="prob-hit">0%</div>
                </div>
                <div class="decision-cell stand" id="cell-stand" onclick="if(!isAutoPlaying) playerAction('stand')">
                    STAND<br>–°–¢–û–ü
                    <div class="prob" id="prob-stand">0%</div>
                </div>
                <div class="decision-cell double" id="cell-double" onclick="if(!isAutoPlaying) playerAction('double')">
                    DOUBLE<br>–ü–û–î–í–Ü–ô–ù–ê
                    <div class="prob" id="prob-double">0%</div>
                </div>
                <div class="decision-cell split" id="cell-split" onclick="if(!isAutoPlaying) playerAction('split')">
                    SPLIT<br>–†–û–ó–î–Ü–õ–ò–¢–ò
                    <div class="prob" id="prob-split">0%</div>
                </div>
            </div>

            <div class="reasoning-box" id="reasoningBox">
                <div class="reasoning-title">üìä –°—Ç–∞–Ω –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ:</div>
                <div id="factorsList">
                    <div class="factor-row">
                        <span>–ó—ñ–±—Ä–∞–Ω–æ –¥–∞–Ω–∏—Ö:</span>
                        <span id="dataPoints">0</span>
                    </div>
                    <div class="factor-row">
                        <span>–í Firebase:</span>
                        <span id="firebaseCount">0</span>
                    </div>
                    <div class="factor-row">
                        <span>–¢–æ—á–Ω—ñ—Å—Ç—å:</span>
                        <span id="modelAccuracy">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏ -->
        <div class="side-bets-panel">
            <div class="panel-title">
                <span>üé≤ –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏</span>
                <span id="totalSideBets">‚Ç¥0</span>
            </div>
            <div class="side-bet-item">
                <span>Perfect Pairs</span>
                <div style="display: flex; gap: 8px;">
                    <input type="number" class="side-bet-amount" id="perfectPairsBet" value="0" step="50" onchange="updateSideBet('perfectPairs')">
                    <div class="side-bet-toggle" id="perfectPairsToggle" onclick="toggleSideBet('perfectPairs')"></div>
                </div>
            </div>
            <div class="side-bet-item">
                <span>21+3</span>
                <div style="display: flex; gap: 8px;">
                    <input type="number" class="side-bet-amount" id="twentyOnePlusThreeBet" value="0" step="50" onchange="updateSideBet('twentyOnePlusThree')">
                    <div class="side-bet-toggle" id="twentyOnePlusThreeToggle" onclick="toggleSideBet('twentyOnePlusThree')"></div>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞–≤–∫–∞ -->
        <div class="betting-panel">
            <div class="panel-title">üí∞ –°–¢–ê–í–ö–ê</div>
            <div class="bet-controls">
                <button class="bet-btn" onclick="changeBet(-50)">‚àí</button>
                <input type="number" class="bet-input" id="currentBetInput" value="250" min="50" step="50" onchange="updateBetFromInput()">
                <button class="bet-btn" onclick="changeBet(50)">+</button>
            </div>
        </div>

        <!-- –Ü–≥—Ä–æ–≤–∞ –∑–æ–Ω–∞ -->
        <div class="game-area">
            <div class="game-box">
                <div class="box-header">
                    <span class="box-title">üé∞ –î–ò–õ–ï–†</span>
                    <span class="score-pill" id="dealerScore">--</span>
                </div>
                <div class="cards-area" id="dealerCards"></div>
            </div>

            <div class="game-box">
                <div class="box-header">
                    <span class="box-title">ü§ñ –ì–†–ê–í–ï–¶–¨</span>
                    <span class="score-pill" id="playerScore">--</span>
                </div>
                <div class="cards-area" id="playerCards"></div>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
        <div class="controls">
            <div class="mode-tabs">
                <button class="tab-btn active" onclick="setMode('manual')" id="tabManual">üéÆ –ì—Ä–∞</button>
                <button class="tab-btn" onclick="showKnowledgeBase()" id="tabKnowledge">üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω—å</button>
                <button class="tab-btn" onclick="showFullTable()" id="tabTable">üìã –¢–∞–±–ª–∏—Ü—è</button>
            </div>

            <div class="control-grid" id="controlArea">
                <button class="big-btn btn-deal" onclick="newRound()" id="mainBtn">üé≤ –ù–û–í–ê –ì–†–ê</button>
                <button class="big-btn btn-autoplay" onclick="startAutoPlay()" id="secondBtn">ü§ñ –ê–í–¢–û–ì–†–ê</button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px;">
                <button class="big-btn btn-learn" onclick="trainNeuralNetwork()" style="padding: 10px;" id="trainBtn">üß† –ù–ê–í–ß–ò–¢–ò</button>
                <button class="big-btn btn-firebase" onclick="saveAllToFirebase()" style="padding: 10px; background: #FFA611;" id="saveBtn">üî• –ó–ë–ï–†–ï–ì–¢–ò</button>
            </div>
        </div>

        <!-- –õ–æ–≥ -->
        <div class="console-log" id="consoleLog">
            <div class="log-line log-info">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –∑ Firebase</div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –ë–ê–ó–ò –ó–ù–ê–ù–¨ -->
    <div class="modal" id="knowledgeModal">
        <div class="modal-content">
            <div class="modal-title">üìö –ë–ê–ó–ê –ó–ù–ê–ù–¨ AI</div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-box-value" id="totalScenarios">0</div>
                    <div style="font-size: 10px;">–í—Å—å–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value" id="trainSamples">0</div>
                    <div style="font-size: 10px;">–î–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value" id="modelAccuracy2">0%</div>
                    <div style="font-size: 10px;">–¢–æ—á–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ</div>
                </div>
            </div>

            <div style="display: flex; gap: 8px; margin: 10px 0;">
                <button class="learn-btn" onclick="loadFromFirebase()" style="background: #FFA611; margin: 0;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
                <button class="learn-btn" onclick="saveToFirebase()" style="background: #00ff88; color: #000; margin: 0;">üì§ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>

            <div class="training-progress" id="trainingProgress" style="display: none;">
                <div style="color: #bc13fe; font-weight: 700;">üîÑ –ù–∞–≤—á–∞–Ω–Ω—è –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="trainingProgressFill" style="width: 0%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span>–ï–ø–æ—Ö–∞: <span id="currentEpoch">0</span>/<span id="totalEpochs">50</span></span>
                    <span class="loss-value" id="currentLoss">0.0000</span>
                </div>
            </div>

            <div id="knowledgeBaseContainer" class="knowledge-base">
                <!-- –¢—É—Ç –±—É–¥–µ –±–∞–∑–∞ –∑–Ω–∞–Ω—å -->
            </div>

            <button class="modal-close-btn" onclick="hideModal('knowledgeModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –ó –¢–ê–ë–õ–ò–¶–ï–Æ –°–¢–†–ê–¢–ï–ì–Ü–á -->
    <div class="modal" id="strategyModal">
        <div class="modal-content">
            <div class="modal-title">üìã –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–ê –¢–ê–ë–õ–ò–¶–Ø</div>
            
            <div class="table-controls">
                <button class="table-btn active" id="tabHardBtn" onclick="showStrategyTable('hard')">Hard</button>
                <button class="table-btn" id="tabSoftBtn" onclick="showStrategyTable('soft')">Soft</button>
                <button class="table-btn" id="tabPairsBtn" onclick="showStrategyTable('pairs')">Pairs</button>
            </div>

            <div id="strategyTableContainer" class="strategy-table-container">
                <!-- –¢—É—Ç –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü—è -->
            </div>

            <button class="modal-close-btn" onclick="hideModal('strategyModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –ü–û–ü–û–í–ù–ï–ù–ù–Ø -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-title">üí∞ –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É</div>
            <input type="number" class="deposit-input" id="depositAmount" placeholder="–°—É–º–∞ (‚Ç¥)" min="100" step="100" value="500">
            <button class="modal-close-btn" onclick="confirmDeposit()" style="background: #00ff88; color: #000;">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</button>
            <button class="modal-close-btn" onclick="hideModal('depositModal')" style="margin-top: 10px; background: #ff6b6b;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <script>
        // ==================== FIREBASE –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCJ6fGZq41Om8D1Agpt3VL7ea-BE1SJcdY",
            authDomain: "bj-app-37763.firebaseapp.com",
            databaseURL: "https://bj-app-37763-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bj-app-37763",
            storageBucket: "bj-app-37763.firebasestorage.app",
            messagingSenderId: "893038526875",
            appId: "1:893038526875:web:d03e29aa24da8d907b213e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const rtdb = firebase.database();
        
        // Firebase —Å—Ç–∞—Ç—É—Å
        let firebaseConnected = false;
        let gamesCount = 0;
        let scenariosCount = 0;
        let modelsCount = 0;

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ====================
        let tfModel = null;
        let isModelReady = false;
        let modelAccuracy = 0;
        let lastLoss = 0;
        
        let balance = 1000;
        let startingBalance = 1000;
        let currentBet = 250;
        let deck = [];
        let dealerHand = [];
        let playerHand = [];
        let playerHands = [];
        let currentHandIndex = 0;
        let runningCount = 0;
        let trueCount = 0;
        let gameState = 'idle';
        let isAutoPlaying = false;
        let autoPlayPaused = false;
        let autoPlaySpeed = 3;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let stats = { 
            totalGames: 0, 
            wins: 0, 
            losses: 0, 
            pushes: 0, 
            correctDecisions: 0, 
            totalDecisions: 0 
        };
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–≥—Ä–∏
        let autoPlayStats = {
            gamesPlayed: 0,
            totalWon: 0,
            totalLost: 0,
            currentStreak: 0
        };
        
        // –ë–ê–ó–ê –ó–ù–ê–ù–¨ AI - –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è
        let knowledgeBase = [];
        let trainingData = [];
        let trainingLabels = [];
        
        // –ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏
        let sideBets = {
            perfectPairs: { active: false, amount: 0 },
            twentyOnePlusThree: { active: false, amount: 0 }
        };

        // ==================== –Ü–î–ï–ê–õ–¨–ù–ê –¢–ê–ë–õ–ò–¶–Ø –°–¢–†–ê–¢–ï–ì–Ü–á ====================
        const baseStrategy = {
            hard: {
                5:  {2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H',A:'H'},
                6:  {2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H',A:'H'},
                7:  {2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H',A:'H'},
                8:  {2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H',A:'H'},
                9:  {2:'H',3:'D',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                10: {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'H',A:'H'},
                11: {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'D',A:'H'},
                12: {2:'H',3:'H',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                13: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                14: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                15: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                16: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H',A:'H'},
                17: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                18: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                19: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                20: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                21: {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'}
            },
            soft: {
                'A,2': {2:'H',3:'H',4:'H',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A,3': {2:'H',3:'H',4:'H',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A,4': {2:'H',3:'H',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A,5': {2:'H',3:'H',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A,6': {2:'H',3:'D',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H',A:'H'},
                'A,7': {2:'S',3:'D',4:'D',5:'D',6:'D',7:'S',8:'S',9:'H',10:'H',A:'H'},
                'A,8': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                'A,9': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                'A,10': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'}
            },
            pairs: {
                '2,2': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'H',9:'H',10:'H',A:'H'},
                '3,3': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'H',9:'H',10:'H',A:'H'},
                '4,4': {2:'H',3:'H',4:'H',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '5,5': {2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'H',A:'H'},
                '6,6': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'H',8:'H',9:'H',10:'H',A:'H'},
                '7,7': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'H',9:'H',10:'H',A:'H'},
                '8,8': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'SP',9:'SP',10:'SP',A:'SP'},
                '9,9': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'S',8:'SP',9:'SP',10:'S',A:'S'},
                '10,10': {2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S',A:'S'},
                'A,A': {2:'SP',3:'SP',4:'SP',5:'SP',6:'SP',7:'SP',8:'SP',9:'SP',10:'SP',A:'SP'}
            }
        };

        let optimizedStrategy = JSON.parse(JSON.stringify(baseStrategy));
        let currentTableView = 'hard';

        // ==================== FIREBASE –§–£–ù–ö–¶–Ü–á ====================
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase
        function checkFirebaseConnection() {
            const dot = document.getElementById('firebaseDot');
            const text = document.getElementById('firebaseText');
            
            if (firebase.apps.length) {
                firebase.firestore().enableNetwork().then(() => {
                    firebaseConnected = true;
                    dot.className = 'firebase-dot connected';
                    text.textContent = 'Firebase Online';
                    addLog('üî• –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ Firebase', 'firebase');
                }).catch(() => {
                    firebaseConnected = false;
                    dot.className = 'firebase-dot';
                    text.textContent = 'Firebase Offline';
                });
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä–∏ –≤ Firebase
        async function saveGameToFirebase(gameData) {
            if (!firebaseConnected) return;
            
            try {
                await db.collection('blackjack_games').add({
                    ...gameData,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    sessionId: sessionId
                });
                gamesCount++;
                document.getElementById('firebaseGames').textContent = gamesCount;
                addLog('üíæ –ì—Ä—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ Firebase', 'firebase');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä–∏:', error);
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ü–µ–Ω–∞—Ä—ñ—é –≤ Firebase
        async function saveScenarioToFirebase(scenario) {
            if (!firebaseConnected) return;
            
            try {
                await db.collection('scenarios').add({
                    ...scenario,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                scenariosCount++;
                document.getElementById('firebaseScenarios').textContent = scenariosCount;
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ü–µ–Ω–∞—Ä—ñ—é:', error);
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ –≤ Firebase
        async function saveModelToFirebase() {
            if (!firebaseConnected || !tfModel) return;
            
            try {
                document.getElementById('systemStatus').textContent = 'üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è';
                document.getElementById('systemStatus').className = 'status-badge saving';
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∞–≥–∏ –º–æ–¥–µ–ª—ñ
                const weights = await tfModel.getWeights();
                const weightsData = weights.map(w => Array.from(w.dataSync()));
                
                await db.collection('ai_models').add({
                    weights: weightsData,
                    accuracy: modelAccuracy,
                    loss: lastLoss,
                    knowledgeBaseSize: knowledgeBase.length,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                modelsCount++;
                document.getElementById('firebaseModels').textContent = modelsCount;
                addLog('üíæ –ú–æ–¥–µ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ Firebase', 'firebase');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ:', error);
            } finally {
                document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
                document.getElementById('systemStatus').className = 'status-badge ready';
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—Å—å–æ–≥–æ –≤ Firebase
        async function saveAllToFirebase() {
            if (!firebaseConnected) {
                addLog('‚ùå Firebase –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ', 'error');
                return;
            }
            
            addLog('üîÑ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —É Firebase...', 'firebase');
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            await db.collection('stats').doc('current').set({
                balance: balance,
                totalGames: stats.totalGames,
                wins: stats.wins,
                losses: stats.losses,
                pushes: stats.pushes,
                accuracy: modelAccuracy,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –±–∞–∑—É –∑–Ω–∞–Ω—å
            for (const scenario of knowledgeBase.slice(-10)) { // –û—Å—Ç–∞–Ω–Ω—ñ 10
                await saveScenarioToFirebase(scenario);
            }
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –º–æ–¥–µ–ª—å
            await saveModelToFirebase();
            
            addLog('‚úÖ –í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É Firebase', 'firebase');
            updateFirebaseStats();
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Firebase
        async function loadFromFirebase() {
            if (!firebaseConnected) return;
            
            addLog('üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Firebase...', 'firebase');
            
            try {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—é –º–æ–¥–µ–ª—å
                const modelsSnapshot = await db.collection('ai_models')
                    .orderBy('timestamp', 'desc')
                    .limit(1)
                    .get();
                
                if (!modelsSnapshot.empty) {
                    const modelData = modelsSnapshot.docs[0].data();
                    addLog(`üì• –ó–Ω–∞–π–¥–µ–Ω–æ –º–æ–¥–µ–ª—å –∑ —Ç–æ—á–Ω—ñ—Å—Ç—é ${modelData.accuracy}%`, 'firebase');
                    
                    // –¢—É—Ç –º–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤–∞–≥–∏ –º–æ–¥–µ–ª—ñ
                    if (modelData.weights && tfModel) {
                        // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∞–≥ –º–æ–¥–µ–ª—ñ
                        console.log('–ú–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤–∞–≥–∏ –º–æ–¥–µ–ª—ñ');
                    }
                }
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statsDoc = await db.collection('stats').doc('current').get();
                if (statsDoc.exists) {
                    const statsData = statsDoc.data();
                    addLog(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${statsData.totalGames} —ñ–≥–æ—Ä`, 'firebase');
                }
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
            }
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase
        async function syncFromFirebase() {
            addLog('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase...', 'firebase');
            await loadFromFirebase();
            updateFirebaseStats();
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ Firebase
        async function updateFirebaseStats() {
            try {
                const gamesSnapshot = await db.collection('blackjack_games').count().get();
                const scenariosSnapshot = await db.collection('scenarios').count().get();
                const modelsSnapshot = await db.collection('ai_models').count().get();
                
                gamesCount = gamesSnapshot.data().count || 0;
                scenariosCount = scenariosSnapshot.data().count || 0;
                modelsCount = modelsSnapshot.data().count || 0;
                
                document.getElementById('firebaseGames').textContent = gamesCount;
                document.getElementById('firebaseScenarios').textContent = scenariosCount;
                document.getElementById('firebaseModels').textContent = modelsCount;
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // ==================== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ====================
        let sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await tf.ready();
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—É
                createNeuralNetwork();
                
                // –°–ø—Ä–æ–±–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—É –º–æ–¥–µ–ª—å –∑ localStorage
                await loadModel();
                
                // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase
                checkFirebaseConnection();
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ Firebase
                setTimeout(() => {
                    if (firebaseConnected) {
                        updateFirebaseStats();
                    }
                }, 2000);
                
                createDeck();
                updateDisplay();
                
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
                document.getElementById('systemStatus').classList.add('ready');
                
                // –°–ª—É—Ö–∞—á —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                document.getElementById('autoSpeed').addEventListener('input', (e) => {
                    autoPlaySpeed = parseInt(e.target.value);
                    document.getElementById('speedValue').textContent = autoPlaySpeed + 'x';
                });
                
                // –°–ø–æ—á–∞—Ç–∫—É —Ö–æ–≤–∞—î–º–æ –ø–∞–Ω–µ–ª—å –∞–≤—Ç–æ–≥—Ä–∏
                document.getElementById('autoPlayPanel').style.display = 'none';
                
                addLog('‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –î–∞–Ω—ñ –±—É–¥—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è –≤ Firebase', 'success');
            } catch (err) {
                console.error(err);
                addLog('–ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
            }
        });

        // ==================== –ù–ï–ô–†–û–ú–ï–†–ï–ñ–ê ====================
        function createNeuralNetwork() {
            tfModel = tf.sequential({
                layers: [
                    tf.layers.dense({
                        inputShape: [10],
                        units: 64,
                        activation: 'relu',
                        kernelInitializer: 'heNormal'
                    }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({
                        units: 32,
                        activation: 'relu',
                        kernelInitializer: 'heNormal'
                    }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({
                        units: 4,
                        activation: 'softmax'
                    })
                ]
            });
            
            tfModel.compile({
                optimizer: tf.train.adam(0.001),
                loss: 'categoricalCrossentropy',
                metrics: ['accuracy']
            });
            
            isModelReady = true;
            addLog('üß† –ù–µ–π—Ä–æ–º–µ—Ä–µ–∂–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞', 'learning');
        }

        // ==================== –ü–Ü–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ò–• ====================
        function prepareTrainingData() {
            if (knowledgeBase.length < 10) {
                addLog('‚ùå –ü–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö (–º—ñ–Ω—ñ–º—É–º 10 —ñ–≥–æ—Ä)', 'error');
                return false;
            }
            
            trainingData = [];
            trainingLabels = [];
            
            knowledgeBase.forEach(scenario => {
                const input = [
                    scenario.playerScore / 21,
                    scenario.dealerCardValue / 11,
                    scenario.hand.length / 5,
                    scenario.canSplit ? 1 : 0,
                    scenario.canDouble ? 1 : 0,
                    scenario.isSoft ? 1 : 0,
                    scenario.trueCount / 10,
                    (scenario.playerScore - scenario.dealerCardValue) / 20,
                    scenario.hand[0]?.value / 11 || 0,
                    scenario.hand[1]?.value / 11 || 0
                ];
                
                const actionIndex = {
                    'hit': 0,
                    'stand': 1,
                    'double': 2,
                    'split': 3
                }[scenario.alternativeAction] || 0;
                
                const label = [0, 0, 0, 0];
                label[actionIndex] = 1;
                
                trainingData.push(input);
                trainingLabels.push(label);
            });
            
            addLog(`üìä –ü—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${trainingData.length} –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è`, 'learning');
            return true;
        }

        // ==================== –ù–ê–í–ß–ê–ù–ù–Ø –ù–ï–ô–†–û–ú–ï–†–ï–ñ–Ü ====================
        async function trainNeuralNetwork() {
            if (!isModelReady) {
                addLog('‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤–∞', 'error');
                return;
            }
            
            if (!prepareTrainingData()) {
                return;
            }
            
            document.getElementById('trainingProgress').style.display = 'block';
            document.getElementById('trainBtn').disabled = true;
            document.getElementById('systemStatus').textContent = 'üß† –ù–∞–≤—á–∞–Ω–Ω—è';
            document.getElementById('systemStatus').className = 'status-badge learning';
            
            const xs = tf.tensor2d(trainingData);
            const ys = tf.tensor2d(trainingLabels);
            
            const epochs = 50;
            const batchSize = Math.min(32, Math.floor(trainingData.length / 2));
            
            addLog(`üöÄ –ü–æ—á–∞—Ç–æ–∫ –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–∞ ${epochs} –µ–ø–æ—Ö–∞—Ö...`, 'learning');
            
            try {
                await tfModel.fit(xs, ys, {
                    epochs: epochs,
                    batchSize: batchSize,
                    validationSplit: 0.2,
                    callbacks: {
                        onEpochEnd: (epoch, logs) => {
                            const progress = ((epoch + 1) / epochs * 100).toFixed(1);
                            document.getElementById('trainingProgressFill').style.width = progress + '%';
                            document.getElementById('currentEpoch').textContent = epoch + 1;
                            document.getElementById('currentLoss').textContent = logs.loss.toFixed(4);
                            
                            lastLoss = logs.loss;
                            modelAccuracy = logs.acc ? (logs.acc * 100).toFixed(1) : 0;
                            
                            if ((epoch + 1) % 10 === 0) {
                                addLog(`üìà –ï–ø–æ—Ö–∞ ${epoch + 1}: loss = ${logs.loss.toFixed(4)}, accuracy = ${modelAccuracy}%`, 'learning');
                            }
                        }
                    }
                });
                
                addLog(`‚úÖ –ù–∞–≤—á–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –§—ñ–Ω–∞–ª—å–Ω–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å: ${modelAccuracy}%`, 'success');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –º–æ–¥–µ–ª—å –≤ Firebase –ø—ñ—Å–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è
                if (firebaseConnected) {
                    await saveModelToFirebase();
                }
                
            } catch (error) {
                addLog(`‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è: ${error.message}`, 'error');
            } finally {
                xs.dispose();
                ys.dispose();
                
                document.getElementById('trainingProgress').style.display = 'none';
                document.getElementById('trainBtn').disabled = false;
                document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
                document.getElementById('systemStatus').className = 'status-badge ready';
                
                updateModelInfo();
            }
        }

        // ==================== –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –ú–û–î–ï–õ–Ü ====================
        async function saveModel() {
            if (!isModelReady) {
                addLog('‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤–∞', 'error');
                return;
            }
            
            try {
                await tfModel.save('localstorage://blackjack-ai-model');
                addLog('üíæ –ú–æ–¥–µ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ', 'success');
            } catch (error) {
                addLog(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${error.message}`, 'error');
            }
        }

        async function loadModel() {
            try {
                const models = await tf.io.listModels();
                if (models['localstorage://blackjack-ai-model']) {
                    tfModel = await tf.loadLayersModel('localstorage://blackjack-ai-model');
                    isModelReady = true;
                    addLog('üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –º–æ–¥–µ–ª—å', 'success');
                }
            } catch (error) {
                console.log('No saved model found');
            }
        }

        // ==================== –§–£–ù–ö–¶–Ü–á –ö–û–õ–û–î–ò ====================
        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = [
                {n:'2',v:2,c:1}, {n:'3',v:3,c:1}, {n:'4',v:4,c:1}, {n:'5',v:5,c:1},
                {n:'6',v:6,c:1}, {n:'7',v:7,c:0}, {n:'8',v:8,c:0}, {n:'9',v:9,c:0},
                {n:'10',v:10,c:-1}, {n:'J',v:10,c:-1}, {n:'Q',v:10,c:-1}, {n:'K',v:10,c:-1}, {n:'A',v:11,c:-1}
            ];
            
            deck = [];
            for (let d = 0; d < 6; d++) {
                for (let s of suits) {
                    for (let v of values) {
                        deck.push({
                            name: v.n, 
                            value: v.v, 
                            count: v.c, 
                            suit: s, 
                            isRed: s === '‚ô•' || s === '‚ô¶'
                        });
                    }
                }
            }
            
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            runningCount = 0;
            trueCount = 0;
            updateDeckVisualization();
        }

        function draw() {
            if (deck.length < 20) {
                addLog('–ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞ –∫–æ–ª–æ–¥–∏...', 'info');
                createDeck();
            }
            const card = deck.pop();
            runningCount += card.count;
            const decksRemaining = deck.length / 52;
            trueCount = decksRemaining > 0 ? runningCount / decksRemaining : 0;
            updateDeckVisualization();
            return card;
        }

        function updateDeckVisualization() {
            document.getElementById('deckCardsCount').textContent = deck.length;
            
            let tempLabel = '‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞';
            let fillPercent = 50;
            
            if (trueCount > 2) {
                tempLabel = 'üî• –ì–∞—Ä—è—á–∞';
                fillPercent = 90;
            } else if (trueCount > 1) {
                tempLabel = '‚ö´ –¢–µ–ø–ª–∞';
                fillPercent = 75;
            } else if (trueCount > 0.5) {
                tempLabel = '‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞';
                fillPercent = 50;
            } else if (trueCount < -1) {
                tempLabel = '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–∞';
                fillPercent = 30;
            } else if (trueCount < -2) {
                tempLabel = 'üßä –î—É–∂–µ —Ö–æ–ª–æ–¥–Ω–∞';
                fillPercent = 20;
            }
            
            document.getElementById('deckTemperatureFill').style.width = fillPercent + '%';
            document.getElementById('deckTemperatureLabel').textContent = tempLabel;
            
            const preview = document.getElementById('deckPreview');
            preview.innerHTML = '';
            
            const previewCards = deck.slice(-8).reverse();
            for (let card of previewCards) {
                const miniCard = document.createElement('div');
                miniCard.className = `mini-card ${card.isRed ? 'red' : 'black'}`;
                if (card.name === 'A') miniCard.textContent = 'A';
                else if (card.value === 10 && card.name !== '10') miniCard.textContent = card.name;
                else miniCard.textContent = card.value;
                preview.appendChild(miniCard);
            }
            
            while (preview.children.length < 8) {
                const emptyCard = document.createElement('div');
                emptyCard.className = 'mini-card back';
                preview.appendChild(emptyCard);
            }
        }

        // ==================== –§–£–ù–ö–¶–Ü–á –ì–†–ò ====================
        function calcScore(hand) {
            let score = 0;
            let aces = 0;
            for (let card of hand) {
                score += card.value;
                if (card.name === 'A') aces++;
            }
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            return score;
        }

        function isSoftHand(hand) {
            let hasAce = false;
            let score = 0;
            for (let card of hand) {
                if (card.name === 'A' && !hasAce) {
                    score += 11;
                    hasAce = true;
                } else {
                    score += card.value;
                }
            }
            return hasAce && score <= 21;
        }

        function canSplitHand(hand) {
            return hand.length === 2 && hand[0].value === hand[1].value;
        }

        function getCurrentState() {
            const currentHand = playerHands[currentHandIndex] || playerHand;
            return {
                playerScore: calcScore(currentHand),
                dealerCard: dealerHand[0]?.value || 0,
                canSplit: canSplitHand(currentHand),
                canDouble: currentHand.length === 2,
                isSoft: isSoftHand(currentHand),
                numCards: currentHand.length,
                hand: [...currentHand],
                dealerUpCard: dealerHand[0],
                trueCount: trueCount
            };
        }

        // ==================== –ë–ê–ó–ê –ó–ù–ê–ù–¨ ====================
        function saveDecisionToKnowledgeBase(decision, outcome) {
            const optimalAction = getOptimalActionFromTable({
                playerScore: calcScore(decision.hand),
                dealerCard: decision.dealerUpCard?.value || 0,
                canSplit: decision.hand.length === 2 && decision.hand[0].value === decision.hand[1].value,
                canDouble: decision.hand.length === 2,
                isSoft: isSoftHand(decision.hand)
            }) || 'stand';
            
            const scenario = {
                id: knowledgeBase.length + 1,
                timestamp: new Date().toISOString(),
                hand: decision.hand.map(c => ({ name: c.name, value: c.value, suit: c.suit })),
                dealerCard: decision.dealerUpCard ? { 
                    name: decision.dealerUpCard.name, 
                    value: decision.dealerUpCard.value 
                } : null,
                playerScore: calcScore(decision.hand),
                dealerCardValue: decision.dealerUpCard?.value || 0,
                actionTaken: decision.action,
                alternativeAction: optimalAction,
                outcome: outcome,
                canSplit: decision.hand.length === 2 && decision.hand[0].value === decision.hand[1].value,
                canDouble: decision.hand.length === 2,
                isSoft: isSoftHand(decision.hand),
                trueCount: trueCount,
                timesEncountered: 1
            };
            
            knowledgeBase.push(scenario);
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ Firebase
            if (firebaseConnected && knowledgeBase.length % 5 === 0) { // –ö–æ–∂–µ–Ω 5-–π —Å—Ü–µ–Ω–∞—Ä—ñ–π
                saveScenarioToFirebase(scenario);
            }
            
            updateModelInfo();
        }

        function getOptimalActionFromTable(state) {
            const {playerScore, dealerCard, canSplit, canDouble, isSoft} = state;
            const dCard = dealerCard === 11 ? 'A' : dealerCard.toString();
            
            if (canSplit) {
                const cardValue = playerHands[currentHandIndex]?.[0]?.value || 0;
                let pairKey;
                if (cardValue === 11) pairKey = 'A,A';
                else if (cardValue === 10) pairKey = '10,10';
                else pairKey = `${cardValue},${cardValue}`;
                
                if (baseStrategy.pairs[pairKey] && baseStrategy.pairs[pairKey][dCard]) {
                    const action = baseStrategy.pairs[pairKey][dCard];
                    if (action === 'H') return 'hit';
                    if (action === 'S') return 'stand';
                    if (action === 'D' && canDouble) return 'double';
                    if (action === 'SP' && canSplit) return 'split';
                }
            } else if (isSoft) {
                const secondCard = playerScore - 11;
                const softKey = `A,${secondCard}`;
                
                if (baseStrategy.soft[softKey] && baseStrategy.soft[softKey][dCard]) {
                    const action = baseStrategy.soft[softKey][dCard];
                    if (action === 'H') return 'hit';
                    if (action === 'S') return 'stand';
                    if (action === 'D' && canDouble) return 'double';
                }
            } else {
                const hardScore = Math.min(21, Math.max(5, playerScore));
                if (baseStrategy.hard[hardScore] && baseStrategy.hard[hardScore][dCard]) {
                    const action = baseStrategy.hard[hardScore][dCard];
                    if (action === 'H') return 'hit';
                    if (action === 'S') return 'stand';
                    if (action === 'D' && canDouble) return 'double';
                }
            }
            
            return null;
        }

        // ==================== –ù–û–í–ê –ì–†–ê ====================
        function newRound() {
            if (isAutoPlaying) {
                addLog('–ó—É–ø–∏–Ω—ñ—Ç—å –∞–≤—Ç–æ–≥—Ä—É —Å–ø–æ—á–∞—Ç–∫—É', 'error');
                return;
            }
            
            if (gameState === 'playing') {
                if (!confirm('–ì—Ä–∞ –≤ –ø—Ä–æ—Ü–µ—Å—ñ. –ü–æ—á–∞—Ç–∏ –Ω–æ–≤—É?')) return;
            }
            
            if (balance < currentBet) {
                addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!', 'error');
                showDepositModal();
                return;
            }

            playerHands = [];
            currentHandIndex = 0;
            
            let sideBetTotal = 0;
            if (sideBets.perfectPairs.active) sideBetTotal += sideBets.perfectPairs.amount;
            if (sideBets.twentyOnePlusThree.active) sideBetTotal += sideBets.twentyOnePlusThree.amount;
            
            if (sideBetTotal > 0 && balance >= currentBet + sideBetTotal) {
                balance -= sideBetTotal;
                addLog(`–ü–æ–±—ñ—á–Ω—ñ —Å—Ç–∞–≤–∫–∏: -‚Ç¥${sideBetTotal}`, 'info');
            }

            balance -= currentBet;
            
            dealerHand = [draw(), draw()];
            playerHand = [draw(), draw()];
            playerHands.push([...playerHand]);
            
            gameState = 'playing';
            
            updateDisplay();
            updateStats();
            updateControls();
            
            setTimeout(() => {
                if (gameState === 'playing') checkBlackjack();
                visualizeAIDecision();
            }, 300);
            
            addLog(`–ù–æ–≤–∞ –≥—Ä–∞. –°—Ç–∞–≤–∫–∞: ‚Ç¥${currentBet}`, 'info');
        }

        function checkBlackjack() {
            const pScore = calcScore(playerHand);
            const dScore = calcScore(dealerHand);
            
            if (pScore === 21 && playerHand.length === 2) {
                if (dScore === 21 && dealerHand.length === 2) {
                    balance += currentBet;
                    addLog('–ü–æ–¥–≤—ñ–π–Ω–∏–π –ë–ª–µ–∫–¥–∂–µ–∫! –ù—ñ—á–∏—è', 'info');
                    endRound('push');
                } else {
                    const winAmount = currentBet * 2.5;
                    balance += winAmount;
                    addLog(`üéâ –ë–ª–µ–∫–¥–∂–µ–∫! +‚Ç¥${Math.floor(winAmount - currentBet)}`, 'success');
                    stats.wins++;
                    stats.totalGames++;
                    endRound('win');
                }
                return true;
            }
            
            if (dScore === 21 && dealerHand.length === 2) {
                addLog('–î–∏–ª–µ—Ä –º–∞—î –±–ª–µ–∫–¥–∂–µ–∫!', 'error');
                stats.losses++;
                stats.totalGames++;
                endRound('lose');
                return true;
            }
            
            return false;
        }

        // ==================== –î–Ü–á –ì–†–ê–í–¶–Ø ====================
        async function playerAction(action) {
            if (gameState !== 'playing' || isAutoPlaying) return;
            
            const currentHand = playerHands[currentHandIndex];
            const state = getCurrentState();
            
            if (action === 'double' && !state.canDouble) return;
            if (action === 'split' && !state.canSplit) return;

            const decision = {
                hand: [...currentHand],
                dealerUpCard: dealerHand[0],
                action: action,
                timestamp: new Date().toISOString()
            };

            switch(action) {
                case 'hit':
                    currentHand.push(draw());
                    addLog('–ì—Ä–∞–≤–µ—Ü—å –±–µ—Ä–µ –∫–∞—Ä—Ç—É', 'info');
                    
                    if (calcScore(currentHand) > 21) {
                        saveDecisionToKnowledgeBase(decision, 'loss');
                        if (currentHandIndex < playerHands.length - 1) {
                            currentHandIndex++;
                            updateDisplay();
                            visualizeAIDecision();
                        } else {
                            dealerPlay(decision);
                        }
                    }
                    break;
                    
                case 'stand':
                    addLog('–ì—Ä–∞–≤–µ—Ü—å –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è', 'info');
                    if (currentHandIndex < playerHands.length - 1) {
                        currentHandIndex++;
                        updateDisplay();
                        visualizeAIDecision();
                    } else {
                        dealerPlay(decision);
                    }
                    break;
                    
                case 'double':
                    if (balance >= currentBet) {
                        balance -= currentBet;
                        currentHand.push(draw());
                        addLog(`–ü–æ–¥–≤—ñ–π–Ω–∞ —Å—Ç–∞–≤–∫–∞!`, 'info');
                        
                        if (calcScore(currentHand) > 21) {
                            saveDecisionToKnowledgeBase(decision, 'loss');
                        }
                        
                        if (currentHandIndex < playerHands.length - 1) {
                            currentHandIndex++;
                            updateDisplay();
                            visualizeAIDecision();
                        } else {
                            dealerPlay(decision);
                        }
                    }
                    break;
                    
                case 'split':
                    if (balance >= currentBet) {
                        balance -= currentBet;
                        const card1 = currentHand[0];
                        const card2 = currentHand[1];
                        
                        playerHands[currentHandIndex] = [card1, draw()];
                        playerHands.push([card2, draw()]);
                        
                        addLog('–°–ø–ª—ñ—Ç!', 'info');
                        updateStats();
                    }
                    break;
            }
            
            updateDisplay();
            updateStats();
            updateControls();
        }

        function dealerPlay(decision) {
            gameState = 'dealer';
            updateDisplay();
            addLog('–•—ñ–¥ –¥–∏–ª–µ—Ä–∞...', 'info');
            
            function play() {
                if (calcScore(dealerHand) < 17) {
                    dealerHand.push(draw());
                    updateDisplay();
                    setTimeout(play, 600);
                } else {
                    determineWinner(decision);
                }
            }
            
            setTimeout(play, 600);
        }

        function determineWinner(decision) {
            const dScore = calcScore(dealerHand);
            let gameResult = '';
            
            playerHands.forEach((hand, idx) => {
                const pScore = calcScore(hand);
                
                if (pScore > 21) {
                    stats.losses++;
                    gameResult = 'loss';
                    if (idx === 0 && decision) saveDecisionToKnowledgeBase(decision, 'loss');
                } else if (dScore > 21 || pScore > dScore) {
                    const winAmount = currentBet * 2;
                    balance += winAmount;
                    stats.wins++;
                    gameResult = 'win';
                    if (idx === 0 && decision) saveDecisionToKnowledgeBase(decision, 'win');
                } else if (pScore === dScore) {
                    balance += currentBet;
                    stats.pushes++;
                    gameResult = 'push';
                    if (idx === 0 && decision) saveDecisionToKnowledgeBase(decision, 'push');
                } else {
                    stats.losses++;
                    gameResult = 'loss';
                    if (idx === 0 && decision) saveDecisionToKnowledgeBase(decision, 'loss');
                }
            });
            
            stats.totalGames++;
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≥—Ä—É –≤ Firebase
            if (firebaseConnected) {
                const gameData = {
                    playerScore: calcScore(playerHand),
                    dealerScore: dScore,
                    bet: currentBet,
                    result: gameResult,
                    profit: gameResult === 'win' ? currentBet : gameResult === 'loss' ? -currentBet : 0,
                    trueCount: trueCount,
                    decisions: [decision]
                };
                saveGameToFirebase(gameData);
            }
            
            endRound('finished');
        }

        function endRound(result) {
            gameState = 'finished';
            updateStats();
            updateControls();
            updateDisplay();
        }

        // ==================== AI –ê–ù–ê–õ–Ü–ó ====================
        async function visualizeAIDecision() {
            if (!tfModel || playerHand.length < 2) return null;
            
            const state = getCurrentState();
            
            let nnAction = null;
            if (isModelReady && knowledgeBase.length >= 10) {
                try {
                    const input = tf.tensor2d([[
                        state.playerScore / 21,
                        state.dealerCard / 11,
                        state.numCards / 5,
                        state.canSplit ? 1 : 0,
                        state.canDouble ? 1 : 0,
                        state.isSoft ? 1 : 0,
                        trueCount / 10,
                        (state.playerScore - state.dealerCard) / 20,
                        state.hand[0]?.value / 11 || 0,
                        state.hand[1]?.value / 11 || 0
                    ]]);
                    
                    const prediction = tfModel.predict(input);
                    const probs = await prediction.data();
                    
                    const actions = ['hit', 'stand', 'double', 'split'];
                    nnAction = actions[probs.indexOf(Math.max(...probs))];
                    
                    document.getElementById('prob-hit').textContent = (probs[0]*100).toFixed(1) + '%';
                    document.getElementById('prob-stand').textContent = (probs[1]*100).toFixed(1) + '%';
                    document.getElementById('prob-double').textContent = (probs[2]*100).toFixed(1) + '%';
                    document.getElementById('prob-split').textContent = (probs[3]*100).toFixed(1) + '%';
                    
                    input.dispose();
                    prediction.dispose();
                } catch (error) {
                    console.log('NN prediction error:', error);
                }
            }
            
            const tableAction = getOptimalActionFromTable(state);
            const bestAction = nnAction || tableAction || 'stand';
            
            document.querySelectorAll('.decision-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            const cell = document.getElementById('cell-' + bestAction);
            if (cell) cell.classList.add('selected');
            
            document.getElementById('vizStatus').textContent = nnAction ? 
                `üß† –ù–µ–π—Ä–æ–º–µ—Ä–µ–∂–∞: ${bestAction.toUpperCase()}` : 
                `üìã –¢–∞–±–ª–∏—Ü—è: ${bestAction.toUpperCase()}`;
            
            return { bestAction };
        }

        // ==================== –ê–í–¢–û–ì–†–ê ====================
        async function startAutoPlay() {
            if (isAutoPlaying) {
                addLog('–ê–≤—Ç–æ–≥—Ä–∞ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∞', 'error');
                return;
            }
            
            if (balance < currentBet) {
                addLog('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–≥—Ä–∏!', 'error');
                showDepositModal();
                return;
            }

            autoPlayStats = {
                gamesPlayed: 0,
                totalWon: 0,
                totalLost: 0,
                currentStreak: 0
            };
            
            isAutoPlaying = true;
            autoPlayPaused = false;
            
            document.getElementById('autoPlayPanel').style.display = 'block';
            document.getElementById('systemStatus').textContent = 'ü§ñ –ê–≤—Ç–æ–≥—Ä–∞';
            document.getElementById('systemStatus').className = 'status-badge autoplay';
            document.getElementById('mainBtn').disabled = true;
            document.getElementById('secondBtn').disabled = true;
            
            updateAutoPlayStats();
            addLog('ü§ñ –ü–æ—á–∞—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –≥—Ä–∏', 'autoplay');
            
            autoPlayLoop();
        }

        async function autoPlayLoop() {
            while (isAutoPlaying && balance >= currentBet) {
                if (autoPlayPaused) {
                    await new Promise(r => setTimeout(r, 500));
                    continue;
                }
                
                await autoPlayRound();
                updateAutoPlayStats();
                
                const delay = [2000, 1500, 1000, 600, 300][autoPlaySpeed - 1];
                await new Promise(r => setTimeout(r, delay));
            }
            
            if (balance < currentBet) {
                addLog('–ê–≤—Ç–æ–≥—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤', 'error');
                stopAutoPlay();
            }
        }

        async function autoPlayRound() {
            playerHands = [];
            currentHandIndex = 0;
            
            if (balance < currentBet) {
                return;
            }
            
            balance -= currentBet;
            
            dealerHand = [draw(), draw()];
            playerHand = [draw(), draw()];
            playerHands.push([...playerHand]);
            
            gameState = 'playing';
            
            updateDisplay();
            updateStats();
            
            const pScore = calcScore(playerHand);
            const dScore = calcScore(dealerHand);
            
            if (pScore === 21 && playerHand.length === 2) {
                if (dScore === 21 && dealerHand.length === 2) {
                    balance += currentBet;
                    addLog('–ù—ñ—á–∏—è (–æ–±–∏–¥–≤–∞ –±–ª–µ–∫–¥–∂–µ–∫)', 'info');
                } else {
                    const winAmount = currentBet * 2.5;
                    balance += winAmount;
                    autoPlayStats.totalWon += currentBet;
                    autoPlayStats.currentStreak++;
                    addLog('üé∞ –ë–ª–µ–∫–¥–∂–µ–∫! +' + Math.floor(winAmount - currentBet), 'success');
                }
                gameState = 'finished';
                autoPlayStats.gamesPlayed++;
                updateDisplay();
                return;
            }
            
            if (dScore === 21 && dealerHand.length === 2) {
                autoPlayStats.totalLost += currentBet;
                autoPlayStats.currentStreak--;
                addLog('–î–∏–ª–µ—Ä –º–∞—î –±–ª–µ–∫–¥–∂–µ–∫', 'error');
                gameState = 'finished';
                autoPlayStats.gamesPlayed++;
                updateDisplay();
                return;
            }
            
            await new Promise(r => setTimeout(r, 300));
            
            const currentHand = playerHands[0];
            let handComplete = false;
            const decisions = [];
            
            while (!handComplete && gameState === 'playing') {
                const state = getCurrentState();
                
                let action = 'stand';
                if (isModelReady && knowledgeBase.length >= 10) {
                    try {
                        const input = tf.tensor2d([[
                            state.playerScore / 21,
                            state.dealerCard / 11,
                            state.numCards / 5,
                            state.canSplit ? 1 : 0,
                            state.canDouble ? 1 : 0,
                            state.isSoft ? 1 : 0,
                            trueCount / 10,
                            (state.playerScore - state.dealerCard) / 20,
                            state.hand[0]?.value / 11 || 0,
                            state.hand[1]?.value / 11 || 0
                        ]]);
                        
                        const prediction = tfModel.predict(input);
                        const probs = await prediction.data();
                        const actions = ['hit', 'stand', 'double', 'split'];
                        action = actions[probs.indexOf(Math.max(...probs))];
                        
                        input.dispose();
                        prediction.dispose();
                    } catch (error) {
                        action = state.playerScore >= 17 ? 'stand' : 'hit';
                    }
                } else {
                    action = state.playerScore >= 17 ? 'stand' : 'hit';
                }
                
                decisions.push({
                    hand: [...currentHand],
                    dealerUpCard: dealerHand[0],
                    action: action,
                    timestamp: new Date().toISOString()
                });
                
                if (action === 'hit') {
                    currentHand.push(draw());
                    updateDisplay();
                    await new Promise(r => setTimeout(r, 400));
                    
                    if (calcScore(currentHand) > 21) {
                        handComplete = true;
                    }
                } else {
                    handComplete = true;
                }
            }
            
            gameState = 'dealer';
            updateDisplay();
            await new Promise(r => setTimeout(r, 500));
            
            while (calcScore(dealerHand) < 17) {
                dealerHand.push(draw());
                updateDisplay();
                await new Promise(r => setTimeout(r, 400));
            }
            
            const finalPScore = calcScore(playerHand);
            const finalDScore = calcScore(dealerHand);
            
            let outcome = '';
            if (finalPScore > 21) {
                outcome = 'loss';
                autoPlayStats.totalLost += currentBet;
                autoPlayStats.currentStreak--;
                addLog('–ü–µ—Ä–µ–±—ñ—Ä', 'error');
            } else if (finalDScore > 21 || finalPScore > finalDScore) {
                outcome = 'win';
                balance += currentBet * 2;
                autoPlayStats.totalWon += currentBet;
                autoPlayStats.currentStreak++;
                addLog('–í–∏–≥—Ä–∞—à! +' + currentBet, 'success');
            } else if (finalPScore === finalDScore) {
                outcome = 'push';
                balance += currentBet;
                addLog('–ù—ñ—á–∏—è', 'info');
            } else {
                outcome = 'loss';
                autoPlayStats.totalLost += currentBet;
                autoPlayStats.currentStreak--;
                addLog('–ü—Ä–æ–≥—Ä–∞—à', 'error');
            }
            
            decisions.forEach(decision => {
                saveDecisionToKnowledgeBase(decision, outcome);
            });
            
            autoPlayStats.gamesPlayed++;
            gameState = 'finished';
            updateDisplay();
            updateStats();
        }

        function stopAutoPlay() {
            isAutoPlaying = false;
            autoPlayPaused = false;
            
            document.getElementById('autoPlayPanel').style.display = 'none';
            document.getElementById('systemStatus').textContent = '‚úÖ –ì–æ—Ç–æ–≤–∏–π';
            document.getElementById('systemStatus').className = 'status-badge ready';
            document.getElementById('mainBtn').disabled = false;
            document.getElementById('secondBtn').disabled = false;
            
            updateControls();
            addLog('–ê–≤—Ç–æ–≥—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞', 'info');
            showKnowledgeBase();
        }

        function toggleAutoPause() {
            autoPlayPaused = !autoPlayPaused;
            const btn = document.getElementById('pauseBtn');
            const status = document.getElementById('autoPlayStatus');
            
            if (autoPlayPaused) {
                btn.textContent = '‚ñ∂ –ü–†–û–î–û–í–ñ–ò–¢–ò';
                status.textContent = '–ü–∞—É–∑–∞';
                addLog('–ê–≤—Ç–æ–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ', 'info');
            } else {
                btn.textContent = '‚è∏ –ü–ê–£–ó–ê';
                status.textContent = '–ì—Ä–∞—î...';
                addLog('–ê–≤—Ç–æ–≥—Ä–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è', 'info');
            }
        }

        function updateAutoPlayStats() {
            document.getElementById('autoGames').textContent = autoPlayStats.gamesPlayed;
            
            const netProfit = autoPlayStats.totalWon - autoPlayStats.totalLost;
            const winEl = document.getElementById('autoWinAmount');
            winEl.textContent = (netProfit >= 0 ? '+' : '') + '‚Ç¥' + Math.floor(netProfit);
            winEl.style.color = netProfit >= 0 ? '#00ff88' : '#ff6b6b';
            
            const streakEl = document.getElementById('autoStreak');
            streakEl.textContent = (autoPlayStats.currentStreak > 0 ? '+' : '') + autoPlayStats.currentStreak;
            streakEl.style.color = autoPlayStats.currentStreak > 0 ? '#00ff88' : autoPlayStats.currentStreak < 0 ? '#ff6b6b' : '#ffd700';
        }

        // ==================== –§–£–ù–ö–¶–Ü–á –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø ====================
        function showKnowledgeBase() {
            const modal = document.getElementById('knowledgeModal');
            updateKnowledgeBaseDisplay();
            renderKnowledgeBase();
            modal.classList.add('show');
        }

        function renderKnowledgeBase() {
            const container = document.getElementById('knowledgeBaseContainer');
            
            if (knowledgeBase.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #aaa; padding: 20px;">–ë–∞–∑–∞ –∑–Ω–∞–Ω—å –ø–æ—Ä–æ–∂–Ω—è. –ì—Ä–∞–π—Ç–µ, —â–æ–± –∑—ñ–±—Ä–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ.</div>';
                return;
            }
            
            const recent = [...knowledgeBase].reverse().slice(0, 10);
            
            let html = '';
            recent.forEach(scenario => {
                const isOptimal = scenario.actionTaken === scenario.alternativeAction;
                
                html += `
                    <div class="scenario-card ${isOptimal ? 'learned' : ''}">
                        <div class="scenario-header">
                            <span>üé¥ –°—Ü–µ–Ω–∞—Ä—ñ–π #${scenario.id}</span>
                            <span class="outcome-badge ${scenario.outcome === 'win' ? 'outcome-win' : scenario.outcome === 'loss' ? 'outcome-loss' : 'outcome-push'}">
                                ${scenario.outcome === 'win' ? 'üí∞' : scenario.outcome === 'loss' ? 'üíî' : 'ü§ù'}
                            </span>
                        </div>
                        
                        <div class="scenario-cards">
                            ${scenario.hand.map(c => `<div class="scenario-mini-card ${c.isRed ? 'red' : 'black'}">${c.name}</div>`).join('')}
                            <div style="margin-left: 10px;">üÉè ${scenario.dealerCard?.name || '?'}</div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>ü§ñ –ó—Ä–æ–±–∏–≤: <span style="color: #ff6b6b;">${getActionName(scenario.actionTaken)}</span></span>
                            <span>‚ú® –¢—Ä–µ–±–∞: <span style="color: #00ff88;">${getActionName(scenario.alternativeAction)}</span></span>
                        </div>
                        
                        ${!isOptimal ? '<div style="color: #ff6b6b; font-size: 9px;">‚ö†Ô∏è –ü–û–ú–ò–õ–ö–ê - –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è</div>' : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getActionName(action) {
            const names = { hit: '–í–ó–Ø–¢–ò', stand: '–°–¢–û–ü', double: '–ü–û–î–í–û–á–¢–ò', split: '–†–û–ó–î–Ü–õ–ò–¢–ò' };
            return names[action] || action;
        }

        function updateKnowledgeBaseDisplay() {
            document.getElementById('totalScenarios').textContent = knowledgeBase.length;
        }

        function updateModelInfo() {
            document.getElementById('dataPoints').textContent = knowledgeBase.length;
            document.getElementById('firebaseCount').textContent = gamesCount;
            document.getElementById('lastLoss').textContent = lastLoss.toFixed(4);
            document.getElementById('modelAccuracy').textContent = modelAccuracy + '%';
            document.getElementById('modelAccuracy2').textContent = modelAccuracy + '%';
            document.getElementById('trainSamples').textContent = trainingData.length;
        }

        // ==================== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –¢–ê–ë–õ–ò–¶–Ü ====================
        function showFullTable() {
            const modal = document.getElementById('strategyModal');
            showStrategyTable('hard');
            modal.classList.add('show');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
        }

        function showStrategyTable(type) {
            currentTableView = type;
            
            document.querySelectorAll('.table-btn').forEach(btn => btn.classList.remove('active'));
            if (type === 'hard') document.getElementById('tabHardBtn').classList.add('active');
            if (type === 'soft') document.getElementById('tabSoftBtn').classList.add('active');
            if (type === 'pairs') document.getElementById('tabPairsBtn').classList.add('active');
            
            const container = document.getElementById('strategyTableContainer');
            const dealerCards = [2, 3, 4, 5, 6, 7, 8, 9, 10, 'A'];
            
            let html = '<table class="strategy-table"><tr><th>–ì—Ä–∞–≤–µ—Ü—å \\ –î–∏–ª–µ—Ä</th>';
            dealerCards.forEach(dc => html += `<th>${dc}</th>`);
            html += '</tr>';

            const data = optimizedStrategy[type];
            
            for (let [playerHand, actions] of Object.entries(data)) {
                html += `<tr><td class="header-col">${playerHand}</td>`;
                
                for (let dc of dealerCards) {
                    const action = actions[dc];
                    
                    let cellClass = '';
                    if (action === 'H') cellClass = 'cell-h';
                    else if (action === 'S') cellClass = 'cell-s';
                    else if (action === 'D') cellClass = 'cell-d';
                    else if (action === 'SP') cellClass = 'cell-sp';
                    
                    html += `<td class="${cellClass}">${action}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</table>';
            container.innerHTML = html;
        }

        // ==================== –û–ù–û–í–õ–ï–ù–ù–Ø –Ü–ù–¢–ï–†–§–ï–ô–°–£ ====================
        function updateDisplay() {
            const currentHand = playerHands[currentHandIndex] || playerHand;
            
            if (playerHands.length > 1) {
                let playerHtml = '';
                playerHands.forEach((hand, idx) => {
                    const isActive = idx === currentHandIndex;
                    playerHtml += `<div style="opacity: ${isActive ? 1 : 0.5}; border: ${isActive ? '2px solid #00ff88' : 'none'}; border-radius: 10px; padding: 4px;">`;
                    playerHtml += hand.map(c => renderCard(c)).join('');
                    playerHtml += `<div style="text-align: center; font-size: 11px;">${calcScore(hand)}</div>`;
                    playerHtml += '</div>';
                });
                document.getElementById('playerCards').innerHTML = playerHtml;
            } else {
                document.getElementById('playerCards').innerHTML = playerHand.map(c => renderCard(c)).join('');
            }
            
            document.getElementById('playerScore').textContent = currentHand ? calcScore(currentHand) : '--';
            
            const dealerHtml = dealerHand.map((c, i) => 
                renderCard(c, gameState === 'playing' && i === 1)
            ).join('');
            document.getElementById('dealerCards').innerHTML = dealerHtml || '<div class="card card-back"></div>';
            
            const dScore = calcScore(dealerHand);
            document.getElementById('dealerScore').textContent = 
                gameState === 'playing' ? (dealerHand[0] ? dealerHand[0].value : '--') : dScore;
        }

        function renderCard(card, hidden = false) {
            if (!card) return '<div class="card card-back"></div>';
            if (hidden) return '<div class="card card-back"></div>';
            
            const cls = card.isRed ? 'red' : 'black';
            return `<div class="card ${cls}">
                <div>${card.name}${card.suit}</div>
                <div class="card-center">${card.suit}</div>
                <div style="transform:rotate(180deg)">${card.name}${card.suit}</div>
            </div>`;
        }

        function updateStats() {
            document.getElementById('balanceValue').textContent = '‚Ç¥' + Math.floor(balance);
            document.getElementById('balanceSub').textContent = 'TC: ' + trueCount.toFixed(1);
            
            const profit = balance - startingBalance;
            const profitEl = document.getElementById('profitValue');
            profitEl.textContent = (profit >= 0 ? '+' : '') + '‚Ç¥' + Math.floor(profit);
            profitEl.className = 'stat-value ' + (profit >= 0 ? 'positive' : profit < 0 ? 'negative' : 'neutral');
            
            const profitPercent = startingBalance > 0 ? (profit / startingBalance * 100) : 0;
            document.getElementById('profitPercent').textContent = (profitPercent > 0 ? '+' : '') + profitPercent.toFixed(1) + '%';
            
            const accuracy = stats.totalDecisions > 0 ? (stats.correctDecisions / stats.totalDecisions * 100) : 0;
            document.getElementById('accuracyValue').textContent = accuracy.toFixed(1) + '%';
            document.getElementById('gamesCount').textContent = stats.totalGames + ' —ñ–≥–æ—Ä';
            
            updateModelInfo();
        }

        function updateControls() {
            if (isAutoPlaying) return;
            
            const controlArea = document.getElementById('controlArea');
            
            if (gameState === 'playing') {
                controlArea.className = 'control-grid four-cols';
                const state = getCurrentState();
                
                controlArea.innerHTML = `
                    <button class="big-btn btn-hit" onclick="playerAction('hit')">–í–ó–Ø–¢–ò</button>
                    <button class="big-btn btn-stand" onclick="playerAction('stand')">–°–¢–û–ü</button>
                    <button class="big-btn btn-double" onclick="playerAction('double')" ${!state.canDouble ? 'disabled' : ''}>–ü–û–î–í.</button>
                    <button class="big-btn btn-split" onclick="playerAction('split')" ${!state.canSplit ? 'disabled' : ''}>–°–ü–õ–Ü–¢</button>
                `;
            } else {
                controlArea.className = 'control-grid';
                controlArea.innerHTML = `
                    <button class="big-btn btn-deal" onclick="newRound()">üé≤ –ù–û–í–ê –ì–†–ê</button>
                    <button class="big-btn btn-autoplay" onclick="startAutoPlay()">ü§ñ –ê–í–¢–û–ì–†–ê</button>
                `;
            }
        }

        function setMode(mode) {
            if (mode === 'manual') {
                document.getElementById('tabManual').classList.add('active');
                document.getElementById('tabKnowledge').classList.remove('active');
                document.getElementById('tabTable').classList.remove('active');
            }
            updateControls();
        }

        // ==================== –ü–û–ë–Ü–ß–ù–Ü –°–¢–ê–í–ö–ò ====================
        function toggleSideBet(type) {
            sideBets[type].active = !sideBets[type].active;
            const toggle = document.getElementById(type + 'Toggle');
            toggle.classList.toggle('active', sideBets[type].active);
            updateTotalSideBets();
        }

        function updateSideBet(type) {
            const amount = parseInt(document.getElementById(type + 'Bet').value) || 0;
            sideBets[type].amount = Math.min(500, Math.max(0, amount));
            updateTotalSideBets();
        }

        function updateTotalSideBets() {
            const total = Object.values(sideBets).reduce((sum, sb) => sum + (sb.active ? sb.amount : 0), 0);
            document.getElementById('totalSideBets').textContent = '‚Ç¥' + total;
        }

        // ==================== –°–¢–ê–í–ö–ò ====================
        function changeBet(delta) {
            const newBet = currentBet + delta;
            if (newBet >= 50 && newBet <= balance) {
                currentBet = newBet;
                document.getElementById('currentBetInput').value = currentBet;
            }
        }

        function updateBetFromInput() {
            const val = parseInt(document.getElementById('currentBetInput').value);
            if (val >= 50 && val <= balance) {
                currentBet = val;
            } else {
                document.getElementById('currentBetInput').value = currentBet;
            }
        }

        // ==================== –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê ====================
        function showDepositModal() {
            document.getElementById('depositModal').classList.add('show');
        }

        function confirmDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            if (amount && amount >= 100) {
                balance += amount;
                startingBalance += amount;
                updateStats();
                hideModal('depositModal');
                addLog(`–ü–æ–ø–æ–≤–Ω–µ–Ω–æ: +‚Ç¥${amount}`, 'success');
            }
        }

        // ==================== –õ–û–ì ====================
        function addLog(msg, type) {
            const log = document.getElementById('consoleLog');
            const line = document.createElement('div');
            line.className = 'log-line log-' + type;
            const time = new Date().toLocaleTimeString('uk-UA', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            line.textContent = time + ' | ' + msg;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
            
            while (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
        }
    </script>
</body>
</html>
